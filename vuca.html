<!-- VUCA Entscheidungsfinder (WP-Snippet) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<div id="vuca-decider-v3" class="vuca-app" aria-label="VUCA Entscheidungsfinder">
  <!-- SECTION 1 -->
  <section class="vuca-card" aria-labelledby="vuca-sec1">
    <div class="vuca-card-head">
      <div class="vuca-headcol">
        <h2 id="vuca-sec1">1. VUCA Entscheidungsfinder</h2>
        <p class="vuca-sub">
          Ein Tool, das einen Fall in <strong>VUCA-Druck</strong> (V/U/C/A) und <strong>VUCA Prime-Reifegrad</strong>
          (Vision/Understanding/Clarity/Agility) übersetzt – inklusive <strong>Toolvorschlägen</strong> und <strong>Roadmap</strong>.
        </p>
      </div>
      <span class="vuca-badge">Decision Tool</span>
    </div>

    <div class="vuca-content">
      <div class="vuca-grid-2">
        <div class="vuca-block">
          <h3 class="vuca-h3">Ziel des Tools</h3>
          <ul class="vuca-list">
            <li><strong>Situation strukturieren</strong>: nicht “ein Gefühl”, sondern ein Profil.</li>
            <li><strong>Entscheidungslogik ableiten</strong>: pro Welt PDCA vs. DCPA.</li>
            <li><strong>Werkzeugkasten liefern</strong>: pro Dimension konkrete Methoden.</li>
            <li><strong>Gaps sichtbar machen</strong>: Wo ist der Druck höher als der Reifegrad?</li>
          </ul>
        </div>

        <div class="vuca-block soft">
          <h3 class="vuca-h3">So nutzt du es (3 Schritte)</h3>
          <ol class="vuca-list">
            <li><strong>Fall ausfüllen</strong> (Titel, Kontext, Ziel).</li>
            <li><strong>Bewerten</strong>:
              <ul class="vuca-list">
                <li>Bis zu 4 <strong>Welten</strong> anlegen (W1–W4) und V/U/C/A per Schieber setzen.</li>
                <li><strong>VUCA Prime</strong>: 5 Fragen je Buchstabe (Grün/Gelb/Rot) beantworten.</li>
              </ul>
            </li>
            <li><strong>Entscheidung lesen</strong>: Radar + Matrix + Gap → Toolvorschläge + Roadmap.</li>
          </ol>
        </div>
      </div>

      <div class="vuca-note">
        <strong>Wichtig:</strong> Beispieltexte erscheinen nur in <em>Platzhaltern</em>. Wenn Felder leer sind, bleibt der Output neutral (—).
      </div>
    </div>
  </section>

  <!-- SECTION 2 -->
  <section class="vuca-card" aria-labelledby="vuca-sec2">
    <div class="vuca-card-head">
      <div class="vuca-headcol">
        <h2 id="vuca-sec2">2. Definition &amp; Logik</h2>
        <p class="vuca-sub">
          VUCA beschreibt die Umwelt (Druck). VUCA Prime beschreibt die Antwortfähigkeit (Reifegrad).
        </p>
      </div>
      <span class="vuca-badge">Definition</span>
    </div>

    <div class="vuca-content">
      <div class="vuca-grid-2">
        <div class="vuca-block">
          <h3 class="vuca-h3">VUCA-Druck (Input)</h3>
          <p class="vuca-text">
            Du bewertest V/U/C/A je Welt mit Schiebern (1–5). Daraus entstehen Radar &amp; Matrix.
          </p>
        </div>
        <div class="vuca-block">
          <h3 class="vuca-h3">VUCA Prime-Reifegrad (Reaktion)</h3>
          <p class="vuca-text">
            Pro Buchstabe 5 Fragen (Grün/Gelb/Rot). Daraus entsteht ein Reifegradprofil (1–5), das wir
            gegen den VUCA-Druck spiegeln → <strong>VUCA Gap</strong>.
          </p>
        </div>
      </div>

      <div class="vuca-hint">
        <strong>Erkenntnis-Logik:</strong> Hoher Druck + niedriger Reifegrad = prioritär handeln (Gap schließen).
        Hoher Druck + hoher Reifegrad = skalieren/standardisieren.
      </div>
    </div>
  </section>

  <!-- SECTION 3 -->
  <section class="vuca-card" aria-labelledby="vuca-sec3">
    <div class="vuca-card-head">
      <div class="vuca-headcol">
        <h2 id="vuca-sec3">3. Fallbeschreibung</h2>
        <p class="vuca-sub">Diese Felder steuern den Ergebnis-Header unten (live).</p>
      </div>
      <span class="vuca-badge">Fall</span>
    </div>

    <div class="vuca-content">
      <div class="vuca-form-grid">
        <div class="vuca-field">
          <label class="vuca-label" for="caseTitle">Titel</label>
          <input id="caseTitle" class="vuca-input" type="text" placeholder="z.B. Kein ESD-Verpackungsmaterial am Markt verfügbar" />
        </div>
        <div class="vuca-field">
          <label class="vuca-label" for="caseContextTeam">Kontext / Team</label>
          <input id="caseContextTeam" class="vuca-input" type="text" placeholder="z.B. Einkauf / Produktion / Qualität" />
        </div>
        <div class="vuca-field vuca-full">
          <label class="vuca-label" for="caseDesc">Kurzbeschreibung (2–3 Sätze)</label>
          <textarea id="caseDesc" class="vuca-textarea" placeholder="Was passiert, was ist unklar/instabil, wo drückt es?"></textarea>
        </div>
        <div class="vuca-field vuca-full">
          <label class="vuca-label" for="caseGoal">Ziel / Outcome</label>
          <input id="caseGoal" class="vuca-input" type="text" placeholder="z.B. Versorgung sichern, Lieferfähigkeit stabilisieren, Risiken minimieren" />
        </div>
      </div>

      <div class="vuca-btn-row">
        <button type="button" class="vuca-btn" id="btnResetCase">Felder leeren</button>
        <button type="button" class="vuca-btn" id="btnBackup">Backup (Browser)</button>
        <button type="button" class="vuca-btn" id="btnRestore">Backup laden</button>
        <button type="button" class="vuca-btn danger" id="btnClearAll">Alles löschen</button>
        <span class="vuca-spacer"></span>
        <div class="vuca-sr" id="ariaStatus" aria-live="polite"></div>
      </div>
    </div>
  </section>

  <!-- SECTION 4 -->
  <section class="vuca-card" aria-labelledby="vuca-sec4">
    <div class="vuca-card-head">
      <div class="vuca-headcol">
        <h2 id="vuca-sec4">4. Bewertung</h2>
        <p class="vuca-sub">
          Lege bis zu 4 Welten an (W1–W4). Jede Welt kann eine andere Entscheidungslogik brauchen.
        </p>
      </div>
      <span class="vuca-badge">Bewertung</span>
    </div>

    <div class="vuca-content">
      <div class="vuca-row-head">
        <div class="vuca-row-title">
          <h3 class="vuca-h3">A) VUCA je Welt (Schieber 1–5)</h3>
          <p class="vuca-hint">Live-Update: Schieber bewegen → Radar/Matrix/Gap aktualisieren sofort.</p>
        </div>
        <div class="vuca-row-actions">
          <button type="button" class="vuca-btn primary" id="btnAddWorld">Welt hinzufügen</button>
        </div>
      </div>

      <div id="worldList" class="world-grid" aria-label="Welten Liste"></div>

      <div class="vuca-divider"></div>

      <div class="vuca-row-head">
        <div class="vuca-row-title">
          <h3 class="vuca-h3">B) VUCA Prime Reifegrad (Highlight)</h3>
          <p class="vuca-hint">
            5 Fragen je Dimension – Antworten als <span class="pill green">Grün</span> / <span class="pill yellow">Gelb</span> / <span class="pill red">Rot</span>.
            <strong>Erst hier</strong> wird die Roadmap “intelligent”.
          </p>
        </div>
      </div>

      <div id="primeGrid" class="prime-grid" aria-label="VUCA Prime Fragen"></div>
    </div>
  </section>

  <!-- SECTION 5 -->
  <section class="vuca-card" aria-labelledby="vuca-sec5">
    <div class="vuca-card-head">
      <div class="vuca-headcol">
        <h2 id="vuca-sec5">5. Darstellung (Dashboard)</h2>
        <p class="vuca-sub">3 Ebenen: Radar (Highlight), Matrix, Gap. Jede Grafik exportierbar.</p>
      </div>
      <span class="vuca-badge">Visuals</span>
    </div>

    <div class="vuca-content">
      <div class="viz-grid">
        <!-- Radar -->
        <div class="viz-card">
          <div class="viz-head">
            <div>
              <div class="viz-title">VUCA Meter (Radar) – Multi-Overlay</div>
              <div class="viz-sub">Polygone je Welt + optional Gesamt + Prime-Reifegrad</div>
            </div>
            <div class="viz-actions">
              <button type="button" class="vuca-btn small primary" id="exportRadarPng">Radar PNG</button>
            </div>
          </div>

          <div class="legend-wrap" id="radarLegend"></div>

          <div class="chart-wrap" id="radarWrap">
            <canvas id="radarChart" aria-label="Radar Chart" role="img"></canvas>
          </div>

          <div class="vuca-hint" id="radarHint">
            Tipp: In der Legende kannst du Welten ein-/ausblenden. “Prime” zeigt deine Antwortfähigkeit (Vision/Understanding/Clarity/Agility) auf derselben Skala (1–5).
          </div>
        </div>

        <!-- Matrix -->
        <div class="viz-card">
          <div class="viz-head">
            <div>
              <div class="viz-title">VUCA Matrix (2×2)</div>
              <div class="viz-sub">x = U+A (Lernen) · y = V+C (Liefern/Steuern)</div>
            </div>
            <div class="viz-actions">
              <button type="button" class="vuca-btn small primary" id="exportMatrixPng">Matrix PNG</button>
            </div>
          </div>

          <div class="matrix-wrap" id="matrixWrap">
            <svg id="vucaMatrix" viewBox="0 0 420 420" aria-label="VUCA Matrix" role="img"></svg>
          </div>

          <div class="vuca-hint">
            Punkte W1–W4 zeigen: <strong>eine Fallbeschreibung</strong> kann mehrere “Welten” enthalten → daher mehrere Punkte.
          </div>
        </div>

        <!-- Gap -->
        <div class="viz-card">
          <div class="viz-head">
            <div>
              <div class="viz-title">VUCA Gap (Druck ↔ Reifegrad)</div>
              <div class="viz-sub">Wo ist der Druck höher als die Antwortfähigkeit?</div>
            </div>
            <div class="viz-actions">
              <button type="button" class="vuca-btn small primary" id="exportGapPng">Gap PNG</button>
            </div>
          </div>

          <div class="gap-wrap" id="gapWrap">
            <div id="gapBars" class="gap-bars"></div>
          </div>

          <div class="insight" id="insightBox">
            Noch keine Bewertungen. Lege mindestens eine Welt an und beantworte Prime-Fragen (Grün/Gelb/Rot).
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SECTION 6 -->
  <section class="vuca-card" aria-labelledby="vuca-sec6">
    <div class="vuca-card-head">
      <div class="vuca-headcol">
        <h2 id="vuca-sec6">6. Methodenauswahl &amp; Tools (Entscheidungsausgabe)</h2>
        <p class="vuca-sub">
          Der Output endet mit konkreten Toolvorschlägen – pro Dimension und als Prioritätenliste.
        </p>
      </div>
      <span class="vuca-badge">Tools</span>
    </div>

    <div class="vuca-content">
      <div class="tool-grid" id="toolGrid"></div>

      <div class="vuca-divider"></div>

      <div class="vuca-block soft" id="autoRecommendations">
        <h3 class="vuca-h3">Automatische Empfehlung (Top-Prioritäten)</h3>
        <div class="vuca-text" id="autoRecText">Noch keine Daten. Bewerte Welten und Prime-Fragen.</div>
      </div>
    </div>
  </section>

  <!-- SECTION 7 -->
  <section class="vuca-card" aria-labelledby="vuca-sec7">
    <div class="vuca-card-head">
      <div class="vuca-headcol">
        <h2 id="vuca-sec7">7. Maßnahmen (Roadmap)</h2>
        <p class="vuca-sub">
          Pro Welt: vorgeschlagene Schleife (PDCA/DCPA) + nächste Schritte (48h / 2 Wochen / 4–8 Wochen).
        </p>
      </div>
      <span class="vuca-badge">Roadmap</span>
    </div>

    <div class="vuca-content">
      <div id="roadmapBox" class="roadmap"></div>
    </div>
  </section>

  <!-- SECTION 8 -->
  <section class="vuca-card" aria-labelledby="vuca-sec8">
    <div class="vuca-card-head">
      <div class="vuca-headcol">
        <h2 id="vuca-sec8">8. Export &amp; Daten</h2>
        <p class="vuca-sub">Alle Grafiken exportieren + JSON Import/Export (am Ende, wie gewünscht).</p>
      </div>
      <span class="vuca-badge">Export</span>
    </div>

    <div class="vuca-content">
      <div class="vuca-grid-2">
        <div class="vuca-block">
          <h3 class="vuca-h3">Grafik-Export (PNG)</h3>
          <div class="vuca-btn-row">
            <button type="button" class="vuca-btn primary" id="exportAllPng">Ganzes Dashboard PNG</button>
            <button type="button" class="vuca-btn" id="exportRadarPng2">Radar PNG</button>
            <button type="button" class="vuca-btn" id="exportMatrixPng2">Matrix PNG</button>
            <button type="button" class="vuca-btn" id="exportGapPng2">Gap PNG</button>
          </div>
          <p class="vuca-hint">Exports verwenden den aktuellen Stand (live). Ideal für Doku/Slides.</p>
        </div>

        <div class="vuca-block">
          <h3 class="vuca-h3">JSON Import/Export</h3>
          <div class="vuca-btn-row">
            <button type="button" class="vuca-btn primary" id="btnExportJson">JSON speichern</button>
            <button type="button" class="vuca-btn" id="btnImportJson">JSON laden</button>
            <input type="file" id="jsonFile" accept="application/json" style="display:none;" />
          </div>
          <p class="vuca-hint">JSON enthält Fall + Welten + Prime-Antworten. Keine Live-Preview (wie gewünscht).</p>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER (Links + Copyright) -->
  <div class="vuca-footer">
    <div class="vuca-footer-links">
      <strong>Weiterführend:</strong>
      <a href="https://www.quality.de/lexikon/vuca/" target="_blank" rel="noopener">VUCA Lexikon</a>
      <span class="sep">·</span>
      <a href="https://www.quality.de/weiterbildung/vuca-seminar-schulung-training/" target="_blank" rel="noopener">VUCA Seminar</a>
      <span class="sep">·</span>
      <a href="https://www.quality.de/weiterbildung/opex-seminare-ausbildungen/opex/" target="_blank" rel="noopener">OPEX Ausbildung</a>
    </div>
    <div class="vuca-footer-copy">
      &copy; <span id="copyrightYear"></span> Quality Services &amp; Wissen GmbH
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>
</div>

<style>
  /* Scoped Styles (WordPress-sicher) */
  #vuca-decider-v3.vuca-app{
    /* CHANGED: Blau statt Türkis */
    --blue:#1155b2;
    --dark:#09387a;

    --bg:#f8fafc;
    --border:rgba(17,85,178,.15);
    --text:#27304d;
    --muted:#64748b;

    --green:#16a34a;
    --yellow:#f59e0b;
    --red:#e53e3e;

    --radius:4px;
    --shadow: 0 4px 12px rgba(27,51,92,.08);

    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    color: var(--text);
    line-height: 1.6;
    max-width: 1100px;
    margin: 0 auto;
    padding: 20px 0;
  }
  #vuca-decider-v3 *{ box-sizing:border-box; }
  #vuca-decider-v3 :focus-visible{ outline: 2px solid var(--blue); outline-offset: 2px; }

  .vuca-card{
    background:#fff;
    border:1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow:hidden;
    margin-bottom: 22px;
  }
  .vuca-card-head{
    background: var(--bg);
    padding: 16px 20px;
    border-bottom: 2px solid var(--blue);
    display:flex;
    justify-content: space-between;
    align-items:center;
    gap: 12px;
    flex-wrap: wrap;
  }
  .vuca-headcol{ display:flex; flex-direction:column; gap:2px; min-width: 260px; }
  .vuca-card-head h2{
    margin:0;
    font-size: 18px;
    color: var(--dark);
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: .5px;
  }
  .vuca-sub{ margin:0; color: var(--muted); font-size: 13px; }
  .vuca-badge{
    background:#fff;
    color: var(--dark);
    border:1px solid rgba(17,85,178,.35); /* CHANGED */
    padding: 4px 10px;
    font-size: 11px;
    font-weight: 900;
    border-radius: 999px;
    text-transform: uppercase;
    white-space: nowrap;
  }
  .vuca-content{ padding: 18px 20px; }

  .vuca-grid-2{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }
  @media(max-width: 860px){ .vuca-grid-2{ grid-template-columns: 1fr; } }

  .vuca-form-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }
  .vuca-full{ grid-column: 1 / -1; }
  @media(max-width: 860px){ .vuca-form-grid{ grid-template-columns: 1fr; } }

  .vuca-block{
    border:1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px;
    background:#fff;
  }
  .vuca-block.soft{
    background: var(--bg);
    border-left: 4px solid var(--blue);
  }
  .vuca-h3{
    margin:0 0 6px;
    font-size: 13px;
    font-weight: 900;
    color: var(--dark);
    text-transform: uppercase;
    letter-spacing: .3px;
  }
  .vuca-text{ margin:0; font-size: 14px; color: var(--text); }
  .vuca-list{ margin:8px 0 0 18px; color: var(--text); font-size: 14px; }
  .vuca-note{
    margin-top: 14px;
    background: rgba(245,158,11,.12);
    border: 1px solid rgba(245,158,11,.35);
    padding: 12px;
    border-radius: var(--radius);
    color: #3f3f46;
    font-size: 13px;
  }
  .vuca-hint{
    margin: 10px 0 0;
    font-size: 12px;
    color: var(--muted);
  }

  .vuca-field{ display:flex; flex-direction:column; gap:6px; }
  .vuca-label{
    font-size: 13px;
    font-weight: 900;
    color: #334155;
    text-transform: uppercase;
    letter-spacing: .2px;
  }
  .vuca-input, .vuca-textarea{
    width:100%;
    padding: 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 14px;
    outline: none;
  }
  .vuca-textarea{ min-height: 92px; resize: vertical; }
  .vuca-input:focus, .vuca-textarea:focus{
    border-color: rgba(17,85,178,.7); /* CHANGED */
    box-shadow: 0 0 0 3px rgba(17,85,178,.12); /* CHANGED */
  }

  .vuca-divider{ height:1px; background:#edf2f7; margin: 16px 0; }

  .vuca-btn-row{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--border);
    align-items:center;
  }
  .vuca-spacer{ flex: 1 1 auto; }
  .vuca-btn{
    background:#fff;
    border: 1px solid var(--border);
    color: var(--dark);
    padding: 10px 14px;
    border-radius: var(--radius);
    font-weight: 900;
    cursor:pointer;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: .3px;
    user-select:none;
  }
  .vuca-btn:hover{ background: #f0f4f8; transform: translateY(-1px); }
  .vuca-btn:active{ transform: translateY(1px); }
  .vuca-btn.primary{
    background: var(--blue);
    color:#fff;
    border-color: var(--blue);
  }
  .vuca-btn.primary:hover{ background: var(--dark); border-color: var(--dark); }
  .vuca-btn.danger{ color: var(--red); border-color: rgba(229,62,62,.35); }
  .vuca-btn.small{ padding: 8px 10px; font-size: 11px; }

  /* Worlds */
  .vuca-row-head{
    display:flex;
    justify-content: space-between;
    align-items:flex-end;
    gap: 12px;
    flex-wrap: wrap;
  }
  .vuca-row-title h3{ margin:0; }
  .world-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 12px;
  }
  @media(max-width: 860px){ .world-grid{ grid-template-columns: 1fr; } }
  .world-card{
    border:1px solid var(--border);
    border-radius: var(--radius);
    background:#fff;
    box-shadow: 0 6px 18px rgba(27,51,92,.05);
    padding: 12px;
  }
  .world-head{
    display:flex;
    justify-content: space-between;
    align-items:center;
    gap: 10px;
    margin-bottom: 10px;
  }
  .world-name{
    font-weight: 900;
    color: #0f172a;
    text-transform: uppercase;
    letter-spacing: .25px;
    font-size: 13px;
    margin:0;
  }
  .world-mini{
    font-size: 12px;
    color: var(--muted);
    margin: 4px 0 0;
  }
  .world-actions{ display:flex; gap:8px; align-items:center; }
  .chip{
    display:inline-flex;
    align-items:center;
    gap: 8px;
    border:1px solid var(--border);
    border-radius: 999px;
    padding: 6px 10px;
    font-size: 12px;
    font-weight: 900;
    background:#fff;
    color:#0f172a;
  }
  .pill{ padding: 2px 8px; border-radius: 999px; font-weight: 900; font-size: 11px; }
  .pill.green{ background: rgba(22,163,74,.12); border:1px solid rgba(22,163,74,.35); }
  .pill.yellow{ background: rgba(245,158,11,.14); border:1px solid rgba(245,158,11,.35); }
  .pill.red{ background: rgba(229,62,62,.12); border:1px solid rgba(229,62,62,.35); }

  .slider-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 14px;
  }
  @media(max-width: 480px){ .slider-grid{ grid-template-columns: 1fr; } }
  .slider{
    padding: 10px;
    border: 1px dashed #e2e8f0;
    border-radius: var(--radius);
    background:#fff;
  }
  .slider-top{
    display:flex;
    justify-content: space-between;
    align-items:baseline;
    gap:10px;
    margin-bottom: 8px;
  }
  .slider-label{ font-weight: 900; font-size: 12px; color:#334155; }
  .slider-val{ font-size: 12px; color: var(--muted); white-space:nowrap; }
  input[type="range"]{ width:100%; }

  /* Prime Questions */
  .prime-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 12px;
  }
  @media(max-width: 860px){ .prime-grid{ grid-template-columns: 1fr; } }
  .prime-card{
    border:1px solid var(--border);
    border-radius: var(--radius);
    background: linear-gradient(180deg, #fff 0%, #fbfdff 100%);
    padding: 12px;
    box-shadow: 0 6px 18px rgba(27,51,92,.05);
  }
  .prime-title{
    display:flex;
    justify-content: space-between;
    gap:10px;
    align-items:baseline;
    margin-bottom: 8px;
  }
  .prime-title h4{
    margin:0;
    font-weight: 900;
    text-transform: uppercase;
    color: var(--dark);
    letter-spacing: .25px;
    font-size: 13px;
  }
  .prime-title .prime-meta{ color: var(--muted); font-size: 12px; }
  .qrow{
    border:1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px;
    margin-bottom: 10px;
    background:#fff;
  }
  .qrow:last-child{ margin-bottom:0; }
  .qtext{ font-size: 13px; font-weight: 800; color:#0f172a; margin:0 0 8px; }
  .traffic{
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items:center;
  }
  .tl{
    display:inline-flex;
    align-items:center;
    gap: 8px;
    border:1px solid var(--border);
    border-radius: 999px;
    padding: 6px 10px;
    cursor:pointer;
    user-select:none;
    font-weight: 900;
    font-size: 12px;
    background:#fff;
  }
  .dot{
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display:inline-block;
  }
  .tl.red .dot{ background: var(--red); }
  .tl.yellow .dot{ background: var(--yellow); }
  .tl.green .dot{ background: var(--green); }
  .tl input{ position:absolute; opacity:0; width:1px; height:1px; }
  .tl.selected{
    box-shadow: 0 6px 14px rgba(0,0,0,.08);
    transform: translateY(-1px);
  }
  .tl.red.selected{ border-color: rgba(229,62,62,.55); background: rgba(229,62,62,.08); }
  .tl.yellow.selected{ border-color: rgba(245,158,11,.55); background: rgba(245,158,11,.10); }
  .tl.green.selected{ border-color: rgba(22,163,74,.55); background: rgba(22,163,74,.08); }

  /* Visuals */
  .viz-grid{
    display:grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 12px;
  }
  @media(max-width: 980px){ .viz-grid{ grid-template-columns: 1fr; } }
  .viz-card{
    border:1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px;
    background:#fff;
    box-shadow: 0 6px 18px rgba(27,51,92,.05);
  }
  .viz-head{
    display:flex;
    justify-content: space-between;
    align-items:flex-start;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 10px;
  }
  .viz-title{
    font-weight: 900;
    font-size: 12px;
    color: var(--dark);
    text-transform: uppercase;
    letter-spacing: .25px;
  }
  .viz-sub{ font-size: 12px; color: var(--muted); margin-top: 2px; }
  .viz-actions{ display:flex; gap: 10px; }

  .chart-wrap{
    height: 360px;
    width: 100%;
    position: relative;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px;
    /* CHANGED: blaues Glow statt türkis */
    background: radial-gradient(circle at center, rgba(17,85,178,.06) 0%, transparent 70%);
  }

  .legend-wrap{
    display:flex;
    flex-wrap:wrap;
    gap: 8px;
    margin-bottom: 10px;
  }
  .leg-item{
    display:flex;
    align-items:center;
    gap: 8px;
    border: 1px solid var(--border);
    border-radius: 999px;
    padding: 6px 10px;
    font-size: 12px;
    font-weight: 900;
    cursor:pointer;
    user-select:none;
    background:#fff;
  }
  .swatch{ width: 10px; height: 10px; border-radius: 2px; }
  .leg-item.off{ opacity: .45; }

  .matrix-wrap{
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: #fff;
    padding: 10px;
  }
  #vucaMatrix{ width:100%; height:auto; display:block; }

  /* Gap */
  .gap-wrap{
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px;
    /* CHANGED */
    background: linear-gradient(to right, rgba(17,85,178,.05), transparent);
  }
  .gap-bars{ display:flex; flex-direction:column; gap: 10px; }
  .gap-row{
    display:grid;
    grid-template-columns: 54px 1fr 46px;
    gap: 10px;
    align-items:center;
  }
  .gap-k{ font-weight: 900; color:#0f172a; font-size: 12px; text-transform: uppercase; }
  .bar{
    position: relative;
    height: 12px;
    border-radius: 999px;
    background: rgba(100,116,139,.14);
    overflow:hidden;
  }
  .bar::after{
    content:"";
    position:absolute;
    left:50%;
    top:0;
    height:100%;
    width:2px;
    background: rgba(15,23,42,.35);
  }
  .fill{
    position:absolute;
    top:0;
    height:100%;
    border-radius: 999px;
  }
  .gap-v{ text-align:right; font-weight: 900; font-size: 12px; color: var(--muted); }
  .insight{
    margin-top: 12px;
    border-left: 4px solid var(--blue);
    background: rgba(17,85,178,.06); /* CHANGED */
    padding: 12px;
    border-radius: var(--radius);
    color: var(--text);
    font-size: 13px;
  }

  /* Tool output */
  .tool-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  @media(max-width: 860px){ .tool-grid{ grid-template-columns: 1fr; } }
  .tool-card{
    border:1px solid var(--border);
    border-radius: var(--radius);
    background:#fff;
    padding: 12px;
    box-shadow: 0 6px 18px rgba(27,51,92,.05);
  }
  .tool-card h4{
    margin:0 0 6px;
    font-size: 13px;
    font-weight: 900;
    text-transform: uppercase;
    color: var(--dark);
  }
  .tool-card p{ margin:0 0 8px; font-size: 13px; color: var(--muted); }
  .tool-card ul{ margin:0 0 0 18px; font-size: 13px; }
  .roadmap{
    display:flex;
    flex-direction:column;
    gap: 12px;
  }
  .roadmap-item{
    border:1px solid var(--border);
    border-radius: var(--radius);
    background:#fff;
    padding: 12px;
    box-shadow: 0 6px 18px rgba(27,51,92,.05);
  }
  .roadmap-top{
    display:flex;
    justify-content: space-between;
    align-items:baseline;
    gap: 10px;
    flex-wrap: wrap;
  }
  .roadmap-title{
    font-weight: 900;
    text-transform: uppercase;
    color:#0f172a;
    font-size: 13px;
  }
  .roadmap-loop{
    font-weight: 900;
    font-size: 12px;
    padding: 4px 10px;
    border-radius: 999px;
    border:1px solid var(--border);
    background:#fff;
  }
  .roadmap-loop.pdca{ border-color: rgba(22,163,74,.35); background: rgba(22,163,74,.08); }
  .roadmap-loop.dcpa{ border-color: rgba(245,158,11,.35); background: rgba(245,158,11,.10); }
  .roadmap-loop.crisis{ border-color: rgba(229,62,62,.35); background: rgba(229,62,62,.08); }
  .roadmap-item ul{ margin: 8px 0 0 18px; font-size: 13px; }
  .toast{
    position: fixed;
    bottom: 18px;
    left: 50%;
    transform: translateX(-50%);
    background: #0f172a;
    color:#fff;
    padding: 12px 18px;
    border-radius: 999px;
    font-size: 14px;
    z-index: 9999;
    opacity: 0;
    pointer-events: none;
    transition: opacity .25s;
    box-shadow: 0 10px 22px rgba(0,0,0,.18);
  }
  .toast.show{ opacity: 1; }
  .vuca-sr{
    position:absolute !important;
    width:1px; height:1px;
    padding:0; margin:-1px;
    overflow:hidden; clip:rect(0,0,0,0);
    white-space:nowrap; border:0;
  }

  /* Footer */
  .vuca-footer{
    margin-top: 10px;
    border-top: 1px solid var(--border);
    padding: 14px 6px 0;
    color: var(--muted);
    font-size: 12px;
    display:flex;
    flex-wrap:wrap;
    gap: 10px 14px;
    justify-content: space-between;
    align-items:center;
  }
  .vuca-footer a{
    color: var(--dark);
    font-weight: 800;
    text-decoration: none;
  }
  .vuca-footer a:hover{ text-decoration: underline; }
  .vuca-footer .sep{ opacity: .6; padding: 0 6px; }
</style>

<script>
(function(){
  const ROOT = document.getElementById("vuca-decider-v3");
  if(!ROOT) return;

  const STORAGE_KEY = "vuca_decider_v3_state";

  const $ = (sel) => ROOT.querySelector(sel);
  const $$ = (sel) => Array.from(ROOT.querySelectorAll(sel));

  function toast(msg){
    const t = $("#toast");
    t.textContent = msg;
    t.classList.add("show");
    window.clearTimeout(toast._tmr);
    toast._tmr = window.setTimeout(() => t.classList.remove("show"), 2600);
  }
  function announce(msg){
    const a = $("#ariaStatus");
    a.textContent = msg;
  }
  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
  function esc(s){
    return String(s ?? "")
      .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;").replace(/'/g,"&#039;");
  }

  // ----------------------------
  // Prime questions (5 per dimension)
  // ----------------------------
  const PRIME = [
    {
      key:"V", name:"Vision (Antwort auf Volatilität)",
      hint:"Orientierung geben, kurz takten, trotzdem stabil entscheiden.",
      qs:[
        "Wir haben einen klaren Nordstern (Vision), der Entscheidungen leitet.",
        "Prioritäten sind für die nächsten 2–4 Wochen verbindlich sichtbar.",
        "Es gibt klare Entscheidungsregeln (was wird sofort entschieden, was eskaliert?).",
        "Wir planen rollierend (Rhythmus) statt starr (Jahresplan).",
        "Puffer/Reserven sind bewusst eingeplant (Zeit, Kapazität, Budget)."
      ]
    },
    {
      key:"U", name:"Understanding (Antwort auf Unsicherheit)",
      hint:"Hypothesen statt Behauptungen – Lernen schneller als Raten.",
      qs:[
        "Annahmen sind sichtbar (Hypothesen-Backlog/Decision Log).",
        "Wir nutzen Pre-Mortem oder Risiko-Checks vor wichtigen Schritten.",
        "Wir arbeiten mit Szenarien (best/base/worst) statt “einem Plan”.",
        "Wir reduzieren Unklarheit aktiv durch Daten/Feedback (kurze Zyklen).",
        "Wir testen klein (MVP/Experiment) bevor wir groß investieren."
      ]
    },
    {
      key:"C", name:"Clarity (Antwort auf Komplexität)",
      hint:"System verstehen, Fokus schaffen, Hebel erkennen.",
      qs:[
        "Wir verstehen zentrale Wechselwirkungen (System-Map / Ursache-Wirkung).",
        "Stakeholder/Rollen sind klar (Einfluss, Betroffenheit, Owner).",
        "Wir visualisieren Arbeit (Kanban) und begrenzen WIP (Fokus).",
        "Wir vereinfachen bewusst (Hebel/80-20) statt alles gleichzeitig zu lösen.",
        "Wir denken in Zeithorizonten (heute–morgen–übermorgen)."
      ]
    },
    {
      key:"A", name:"Agility (Antwort auf Ambiguität)",
      hint:"Gemeinsame Definitionen + schnelle Anpassung im Tun.",
      qs:[
        "Begriffe/Erfolg sind definiert (DoD/DoR, Erfolgskriterien).",
        "Alignment ist explizit (Ziel/Nicht-Ziel, Grenzen, Trade-offs).",
        "Entscheidungen sind rollenbasiert (RACI/DACI) und nachvollziehbar.",
        "Wir nutzen Beispiele/Story-Mapping statt nur Abstraktionen.",
        "Wir iterieren aktiv (Retro/Learnings) und passen Kurs schnell an."
      ]
    }
  ];

  // Traffic light values: red=1, yellow=2, green=3 (map to 1..5 later)
  const TL = [
    {k:"red", label:"Rot", v:1},
    {k:"yellow", label:"Gelb", v:2},
    {k:"green", label:"Grün", v:3},
  ];

  // ----------------------------
  // Worlds (1..4)
  // ----------------------------
  const WORLD_MAX = 4;

  function defaultWorld(i){
    return {
      id: cryptoId(),
      name: `W${i}`,
      note: "",
      V: 3, U: 3, C: 3, A: 3
    };
  }

  function cryptoId(){
    try{ return crypto.randomUUID(); }catch{ return "id_" + Math.random().toString(16).slice(2); }
  }

  // State
  let state = {
    caseTitle:"",
    caseContextTeam:"",
    caseDesc:"",
    caseGoal:"",
    worlds: [ defaultWorld(1) ],
    prime: {
      // prime[key] = [null|1|2|3] length 5
      V: [null,null,null,null,null],
      U: [null,null,null,null,null],
      C: [null,null,null,null,null],
      A: [null,null,null,null,null],
    },
    ts: new Date().toISOString()
  };

  // ----------------------------
  // Persist
  // ----------------------------
  function persist(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }
  function restore(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return false;
    try{
      const p = JSON.parse(raw);
      if(!p || typeof p !== "object") return false;

      state.caseTitle = String(p.caseTitle ?? "");
      state.caseContextTeam = String(p.caseContextTeam ?? "");
      state.caseDesc = String(p.caseDesc ?? "");
      state.caseGoal = String(p.caseGoal ?? "");

      state.worlds = Array.isArray(p.worlds) && p.worlds.length
        ? p.worlds.slice(0, WORLD_MAX).map((w, idx)=>({
            id: String(w.id ?? cryptoId()),
            name: String(w.name ?? `W${idx+1}`),
            note: String(w.note ?? ""),
            V: clamp(Number(w.V ?? 3), 1, 5),
            U: clamp(Number(w.U ?? 3), 1, 5),
            C: clamp(Number(w.C ?? 3), 1, 5),
            A: clamp(Number(w.A ?? 3), 1, 5),
          }))
        : [ defaultWorld(1) ];

      const pr = p.prime || {};
      ["V","U","C","A"].forEach(k=>{
        const arr = Array.isArray(pr[k]) ? pr[k] : [];
        state.prime[k] = Array.from({length:5}, (_,i)=>{
          const v = arr[i];
          return (v===1||v===2||v===3) ? v : null;
        });
      });

      state.ts = String(p.ts ?? new Date().toISOString());
      return true;
    }catch(e){
      return false;
    }
  }

  // ----------------------------
  // UI builders
  // ----------------------------
  function syncCaseInputs(){
    $("#caseTitle").value = state.caseTitle;
    $("#caseContextTeam").value = state.caseContextTeam;
    $("#caseDesc").value = state.caseDesc;
    $("#caseGoal").value = state.caseGoal;
  }

  function buildWorldList(){
    const host = $("#worldList");
    host.innerHTML = "";

    state.worlds.forEach((w, idx)=>{
      const card = document.createElement("div");
      card.className = "world-card";
      card.innerHTML = `
        <div class="world-head">
          <div>
            <p class="world-name">${esc(w.name || `W${idx+1}`)}</p>
            <p class="world-mini">Optional: kurze Notiz (bleibt leer, wenn du nichts einträgst).</p>
          </div>
          <div class="world-actions">
            <span class="chip">Welt ${idx+1} / ${state.worlds.length}</span>
            ${state.worlds.length > 1 ? `<button type="button" class="vuca-btn small danger" data-act="rmWorld" data-id="${esc(w.id)}">Entfernen</button>` : ""}
          </div>
        </div>

        <div class="vuca-field" style="margin-bottom:10px;">
          <label class="vuca-label" for="worldName_${esc(w.id)}">Name</label>
          <input class="vuca-input" id="worldName_${esc(w.id)}" type="text" value="${esc(w.name)}" placeholder="z.B. Versorgung sichern / Alternativen testen" />
        </div>

        <div class="vuca-field" style="margin-bottom:12px;">
          <label class="vuca-label" for="worldNote_${esc(w.id)}">Notiz (optional)</label>
          <input class="vuca-input" id="worldNote_${esc(w.id)}" type="text" value="${esc(w.note)}" placeholder="z.B. Fokus / Hypothese / Messpunkt (optional)" />
        </div>

        <div class="slider-grid">
          ${sliderHtml(w, "V", "Volatilität")}
          ${sliderHtml(w, "U", "Unsicherheit")}
          ${sliderHtml(w, "C", "Komplexität")}
          ${sliderHtml(w, "A", "Ambiguität")}
        </div>
      `;
      host.appendChild(card);
    });

    // Wire up events
    state.worlds.forEach(w=>{
      const nameEl = $(`#worldName_${cssId(w.id)}`);
      const noteEl = $(`#worldNote_${cssId(w.id)}`);
      if(nameEl){
        nameEl.addEventListener("input", ()=>{
          w.name = nameEl.value.trim();
          scheduleUpdate();
        });
      }
      if(noteEl){
        noteEl.addEventListener("input", ()=>{
          w.note = noteEl.value.trim();
          scheduleUpdate();
        });
      }
      ["V","U","C","A"].forEach(k=>{
        const r = $(`#world_${cssId(w.id)}_${k}`);
        const v = $(`#world_${cssId(w.id)}_${k}_v`);
        if(r && v){
          r.addEventListener("input", ()=>{
            const n = clamp(Number(r.value), 1, 5);
            w[k] = n;
            v.textContent = String(n);
            scheduleUpdate();
          });
        }
      });
    });

    // Remove buttons
    host.querySelectorAll('[data-act="rmWorld"]').forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.getAttribute("data-id");
        state.worlds = state.worlds.filter(w=>w.id !== id);
        // re-label default names if empty
        state.worlds.forEach((w, i)=>{ if(!w.name) w.name = `W${i+1}`; });
        buildWorldList();
        scheduleUpdate();
      });
    });

    // Add world button enabled/disabled
    $("#btnAddWorld").disabled = state.worlds.length >= WORLD_MAX;
  }

  function cssId(s){
    return String(s).replace(/[^a-zA-Z0-9_-]/g,"_");
  }

  function sliderHtml(w, key, label){
    const val = w[key];
    const id = cssId(w.id);
    return `
      <div class="slider">
        <div class="slider-top">
          <div class="slider-label">${key}) ${label}</div>
          <div class="slider-val">Wert: <span id="world_${id}_${key}_v">${val}</span></div>
        </div>
        <input id="world_${id}_${key}" type="range" min="1" max="5" value="${val}" />
      </div>
    `;
  }

  function buildPrimeGrid(){
    const host = $("#primeGrid");
    host.innerHTML = "";

    PRIME.forEach(dim=>{
      const card = document.createElement("div");
      card.className = "prime-card";
      card.innerHTML = `
        <div class="prime-title">
          <h4>${esc(dim.key)} · ${esc(dim.name)}</h4>
          <div class="prime-meta">5 Fragen · Grün/Gelb/Rot</div>
        </div>
        <div class="vuca-hint" style="margin:0 0 10px;">${esc(dim.hint)}</div>
        ${dim.qs.map((qt, i)=> primeQHtml(dim.key, i, qt)).join("")}
      `;
      host.appendChild(card);
    });

    // Wire up selections
    PRIME.forEach(dim=>{
      dim.qs.forEach((_, i)=>{
        const groupName = `prime_${dim.key}_${i}`;
        const row = host.querySelector(`[data-prime-row="${groupName}"]`);
        if(!row) return;

        row.querySelectorAll("label.tl").forEach(lab=>{
          lab.addEventListener("click", ()=>{
            const v = Number(lab.getAttribute("data-val"));
            state.prime[dim.key][i] = (v===1||v===2||v===3) ? v : null;

            // visual selection
            row.querySelectorAll("label.tl").forEach(x=>x.classList.remove("selected"));
            lab.classList.add("selected");

            scheduleUpdate();
          });
        });

        // initial highlight
        const current = state.prime[dim.key][i];
        if(current){
          const lab = row.querySelector(`label.tl[data-val="${current}"]`);
          if(lab) lab.classList.add("selected");
        }
      });
    });
  }

  function primeQHtml(dimKey, idx, text){
    const group = `prime_${dimKey}_${idx}`;
    return `
      <div class="qrow" data-prime-row="${group}">
        <p class="qtext">${esc(text)}</p>
        <div class="traffic" role="group" aria-label="Antwort ${dimKey} Frage ${idx+1}">
          ${TL.map(o=>`
            <label class="tl ${o.k}" data-val="${o.v}" title="${o.label}">
              <span class="dot" aria-hidden="true"></span>
              ${o.label}
              <input type="radio" name="${group}" value="${o.v}">
            </label>
          `).join("")}
        </div>
      </div>
    `;
  }

  // ----------------------------
  // Visuals: Radar (Chart.js), Matrix (SVG), Gap Bars
  // ----------------------------
  let radarChart = null;

  /* CHANGED: Palette (Türkis -> Blau) */
  const palette = [
    {border:"rgba(17,85,178,.85)", fill:"rgba(17,85,178,.14)"},
    {border:"rgba(245,158,11,.90)", fill:"rgba(245,158,11,.14)"},
    {border:"rgba(22,163,74,.85)", fill:"rgba(22,163,74,.12)"},
    {border:"rgba(229,62,62,.85)", fill:"rgba(229,62,62,.12)"},
  ];

  function ensureRadar(){
    const canvas = $("#radarChart");
    const ctx = canvas.getContext("2d");

    const glow = {
      id: "glow",
      beforeDatasetsDraw(chart){
        const {ctx} = chart;
        ctx.save();
        ctx.shadowColor = "rgba(0,0,0,0.10)";
        ctx.shadowBlur = 8;
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 2;
      },
      afterDatasetsDraw(chart){
        chart.ctx.restore();
      }
    };

    radarChart = new Chart(ctx, {
      type: "radar",
      data: {
        labels: ["V","U","C","A"],
        datasets: []
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: { duration: 180 },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              title(items){
                const l = items[0].label;
                return (l==="V") ? "V – Volatilität / Vision"
                  : (l==="U") ? "U – Unsicherheit / Understanding"
                  : (l==="C") ? "C – Komplexität / Clarity"
                  : "A – Ambiguität / Agility";
              },
              label(ctx){
                return `${ctx.dataset.label}: ${ctx.raw}`;
              }
            }
          }
        },
        scales: {
          r: {
            min: 1,
            max: 5,
            ticks: { stepSize: 1, backdropColor: "transparent" },
            grid: { color: "rgba(0,0,0,0.05)" },
            angleLines: { color: "rgba(0,0,0,0.05)" },
            pointLabels: { color: "#09387a", font: { size: 12, weight: "700" } } /* CHANGED */
          }
        },
        elements: {
          line: { borderWidth: 2 },
          point: { radius: 3 }
        }
      },
      plugins: [glow]
    });
  }

  function primeReadiness5(){
    const out = {V:null,U:null,C:null,A:null, missing:false};
    ["V","U","C","A"].forEach(k=>{
      const arr = state.prime[k];
      const answered = arr.filter(v=>v===1||v===2||v===3);
      if(answered.length === 0){
        out[k] = null;
        out.missing = true;
        return;
      }
      const avg = answered.reduce((a,b)=>a+b,0)/answered.length; // 1..3
      out[k] = Math.round((1 + (avg - 1) * 2) * 10) / 10; // 1..5
      if(answered.length < 5) out.missing = true;
    });
    return out;
  }

  function worldPressureAvg(){
    const n = state.worlds.length || 1;
    const sum = {V:0,U:0,C:0,A:0};
    state.worlds.forEach(w=>{
      sum.V += w.V; sum.U += w.U; sum.C += w.C; sum.A += w.A;
    });
    return {
      V: +(sum.V/n).toFixed(1),
      U: +(sum.U/n).toFixed(1),
      C: +(sum.C/n).toFixed(1),
      A: +(sum.A/n).toFixed(1),
    };
  }

  function updateRadar(){
    if(!radarChart) ensureRadar();

    const readiness = primeReadiness5();
    const datasets = [];

    state.worlds.forEach((w, i)=>{
      const col = palette[i % palette.length];
      const label = (w.name && w.name.trim()) ? w.name.trim() : `W${i+1}`;
      datasets.push({
        label,
        data: [w.V, w.U, w.C, w.A],
        borderColor: col.border,
        backgroundColor: col.fill,
        pointBackgroundColor: col.border,
        borderWidth: 2
      });
    });

    const avg = worldPressureAvg();
    datasets.push({
      label: "Gesamt (Mittel)",
      data: [avg.V, avg.U, avg.C, avg.A],
      borderColor: "rgba(15,23,42,.65)",
      backgroundColor: "rgba(15,23,42,.05)",
      pointBackgroundColor: "rgba(15,23,42,.75)",
      borderWidth: 2,
      borderDash: [6,4]
    });

    const prData = ["V","U","C","A"].map(k => readiness[k] ?? null);
    const hasAny = prData.some(v=>typeof v === "number");
    if(hasAny){
      datasets.push({
        label: "Prime (Reifegrad)",
        data: prData.map(v => v ?? 1),
        borderColor: "rgba(9,56,122,.85)",         /* CHANGED */
        backgroundColor: "rgba(9,56,122,.10)",     /* CHANGED */
        pointBackgroundColor: "rgba(9,56,122,.90)",/* CHANGED */
        borderWidth: 3,
        borderDash: [2,2]
      });
    }

    radarChart.data.datasets = datasets;
    radarChart.update();

    buildRadarLegend(datasets);
  }

  function buildRadarLegend(datasets){
    const host = $("#radarLegend");
    host.innerHTML = "";

    datasets.forEach((ds, i)=>{
      const item = document.createElement("div");
      item.className = "leg-item";
      item.innerHTML = `
        <span class="swatch" style="background:${ds.borderColor}"></span>
        ${esc(ds.label)}
      `;
      host.appendChild(item);

      item.addEventListener("click", ()=>{
        radarChart.data.datasets[i].hidden = !radarChart.data.datasets[i].hidden;
        item.classList.toggle("off", radarChart.data.datasets[i].hidden === true);
        radarChart.update();
      });

      if(datasets[i].hidden) item.classList.add("off");
    });
  }

  function renderMatrix(){
    const svg = $("#vucaMatrix");
    while(svg.firstChild) svg.removeChild(svg.firstChild);

    const W=420,H=420,pad=44, top=24, innerW=W-pad-18, innerH=H-top-40;

    addSvg(svg, "rect", {x:0,y:0,width:W,height:H,fill:"#fff"});
    addSvg(svg, "rect", {x:pad,y:top,width:innerW,height:innerH,fill:"#fff",stroke:"rgba(17,85,178,.15)","stroke-width":"1"});

    addSvg(svg,"rect",{x:pad,y:top,width:innerW/2,height:innerH/2,fill:"rgba(22,163,74,.08)"});
    addSvg(svg,"rect",{x:pad+innerW/2,y:top,width:innerW/2,height:innerH/2,fill:"rgba(245,158,11,.10)"});
    addSvg(svg,"rect",{x:pad,y:top+innerH/2,width:innerW/2,height:innerH/2,fill:"rgba(17,85,178,.08)"}); /* CHANGED */
    addSvg(svg,"rect",{x:pad+innerW/2,y:top+innerH/2,width:innerW/2,height:innerH/2,fill:"rgba(229,62,62,.07)"});

    addSvg(svg,"line",{x1:pad+innerW/2,y1:top,x2:pad+innerW/2,y2:top+innerH,stroke:"rgba(15,23,42,.25)","stroke-width":"1"});
    addSvg(svg,"line",{x1:pad,y1:top+innerH/2,x2:pad+innerW,y2:top+innerH/2,stroke:"rgba(15,23,42,.25)","stroke-width":"1"});

    addText(svg, pad+innerW/2, H-10, "U + A  →  Lernen / Klärung", "middle", "axis");
    addText(svg, 14, top+innerH/2, "↑  V + C  (Steuern / Liefern)", "middle", "axis", true, 14, top+innerH/2);

    qLabel(svg, pad+innerW*0.25, top+innerH*0.22, "Fokus: Flow", "C/V hoch · U/A niedrig");
    qLabel(svg, pad+innerW*0.75, top+innerH*0.22, "Fokus: Lernen", "C/V hoch · U/A hoch");
    qLabel(svg, pad+innerW*0.25, top+innerH*0.72, "Fokus: Stabilisieren", "C/V niedrig · U/A niedrig");
    qLabel(svg, pad+innerW*0.75, top+innerH*0.72, "Fokus: Experiment", "C/V niedrig · U/A hoch");

    state.worlds.forEach((w, i)=>{
      const x01 = clamp((w.U + w.A)/10, 0, 1);
      const y01 = clamp((w.V + w.C)/10, 0, 1);

      const x = pad + innerW*x01;
      const y = top + innerH*(1 - y01);

      const col = palette[i % palette.length].border;
      addSvg(svg, "circle", {cx:x, cy:y, r:7, fill:col, stroke:"#0f172a","stroke-width":"1"});
      addText(svg, x, y-12, (w.name && w.name.trim()) ? w.name.trim() : `W${i+1}`, "middle", "tick");
    });

    const avg = worldPressureAvg();
    const x01 = clamp((avg.U + avg.A)/10, 0, 1);
    const y01 = clamp((avg.V + avg.C)/10, 0, 1);
    const ox = pad + innerW*x01;
    const oy = top + innerH*(1 - y01);

    addSvg(svg, "circle", {cx:ox, cy:oy, r:6, fill:"rgba(15,23,42,.65)", stroke:"#0f172a","stroke-width":"1"});
    addText(svg, ox, oy+20, "Gesamt", "middle", "tick");
  }

  function addSvg(svg, tag, attrs){
    const el = document.createElementNS("http://www.w3.org/2000/svg", tag);
    Object.entries(attrs).forEach(([k,v])=>el.setAttribute(k, String(v)));
    svg.appendChild(el);
    return el;
  }
  function addText(svg, x, y, text, anchor, cls, rotate=false, rx=0, ry=0){
    const t = addSvg(svg, "text", {
      x, y, "text-anchor": anchor,
      "font-family":"ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial",
      "font-weight": "800",
      "font-size": cls==="axis" ? "11" : (cls==="tick" ? "10" : "12"),
      "fill": cls==="axis" ? "#334155" : (cls==="tick" ? "#64748b" : "#0f172a")
    });
    if(rotate){
      t.setAttribute("transform", `rotate(-90 ${rx} ${ry})`);
    }
    t.textContent = text;
    return t;
  }
  function qLabel(svg, x, y, main, sub){
    addText(svg, x, y, main, "middle", "main");
    addText(svg, x, y+12, sub, "middle", "tick");
  }

  function updateGapBars(){
    const host = $("#gapBars");
    host.innerHTML = "";

    const avg = worldPressureAvg();
    const readiness = primeReadiness5();

    const dims = [
      {k:"V", name:"V"},
      {k:"U", name:"U"},
      {k:"C", name:"C"},
      {k:"A", name:"A"},
    ];

    dims.forEach(d=>{
      const pressure = avg[d.k];
      const ready = (typeof readiness[d.k] === "number") ? readiness[d.k] : null;
      const gap = (ready === null) ? null : +(pressure - ready).toFixed(1);

      const maxAbs = 4;
      const pct = gap === null ? 0 : clamp((Math.abs(gap)/maxAbs)*50, 0, 50);
      const left = gap === null ? 50 : (gap >= 0 ? 50 : 50 - pct);
      const width = gap === null ? 0 : pct;

      let color = "rgba(100,116,139,.0)";
      if(gap !== null){
        color = (gap >= 2) ? "rgba(229,62,62,.80)"
              : (gap >= 1) ? "rgba(245,158,11,.85)"
              : (gap >= 0) ? "rgba(22,163,74,.55)"
              : "rgba(22,163,74,.85)";
      }

      const row = document.createElement("div");
      row.className = "gap-row";
      row.innerHTML = `
        <div class="gap-k">${d.name}</div>
        <div class="bar">
          <div class="fill" style="left:${left}%; width:${width}%; background:${color};"></div>
        </div>
        <div class="gap-v">${gap === null ? "—" : (gap > 0 ? "+"+gap : String(gap))}</div>
      `;
      host.appendChild(row);
    });
  }

  // ----------------------------
  // Tools + Roadmap (unverändert)
  // ----------------------------
  const TOOLBOX = {
    V: {
      title: "Volatilität → Vision",
      desc: "Wenn sich Rahmenbedingungen schnell ändern: kurz takten, Orientierung halten.",
      tools: [
        "OODA-Loop (Observe–Orient–Decide–Act)",
        "Rolling Planning / Re-Planungsrhythmus (2–4 Wochen)",
        "MoSCoW / Eisenhower zur Priorisierung",
        "Kanban + WIP-Limits (Fokus statt Parallelität)",
        "Pufferplanung / 15%-Regel (Volatilität einkalkulieren)",
        "OKR (light) für Fokus & Messbarkeit"
      ]
    },
    U: {
      title: "Unsicherheit → Understanding",
      desc: "Wenn Infos fehlen: Hypothesen sichtbar machen, lernen statt raten.",
      tools: [
        "Hypothesen-Backlog / Assumption Log",
        "Pre-Mortem (was könnte schiefgehen?)",
        "Szenariotechnik (best/base/worst)",
        "Cone of Uncertainty (bewusst nachschärfen)",
        "Experimentdesign / MVP-Denken (klein testen)",
        "Entscheidungslog (Decision Log) + Trigger für Re-Bewertung"
      ]
    },
    C: {
      title: "Komplexität → Clarity",
      desc: "Wenn Ursache–Wirkung nicht linear ist: System verstehen, sichere Schritte gehen.",
      tools: [
        "System-Mapping / Causal-Loop Thinking",
        "Stakeholder-Map (Einfluss/Betroffenheit)",
        "Wertstrom-Sicht / Wardley Mapping (light)",
        "Safe-to-fail Experimente (mehrere kleine Versuche)",
        "3 Horizons / Horizon Thinking",
        "A3-Problem Solving (Lean, strukturiert)"
      ]
    },
    A: {
      title: "Ambiguität → Agility",
      desc: "Wenn Begriffe/Ziele unterschiedlich interpretiert werden: gemeinsame Sprache + schnelle Anpassung.",
      tools: [
        "Definition of Done / Definition of Ready",
        "Alignment Canvas (Ziel/Nicht-Ziel, Erfolgskriterien, Grenzen)",
        "RACI / DACI (Rollen & Entscheidungen klären)",
        "Kontext-Check: “Was bedeutet das konkret im Alltag?”",
        "Story Mapping / Beispiele statt Abstraktionen",
        "Retrospektive (Start/Stop/Continue) – Lernen systematisieren"
      ]
    }
  };

  function buildToolGrid(){
    const host = $("#toolGrid");
    host.innerHTML = "";

    ["V","U","C","A"].forEach(k=>{
      const b = TOOLBOX[k];
      const card = document.createElement("div");
      card.className = "tool-card";
      card.innerHTML = `
        <h4>${esc(k)} · ${esc(b.title)}</h4>
        <p>${esc(b.desc)}</p>
        <ul>${b.tools.map(t=>`<li>${esc(t)}</li>`).join("")}</ul>
      `;
      host.appendChild(card);
    });
  }

  function chooseLoopForWorld(w){
    const learn = w.U + w.A;
    const deliver = w.V + w.C;
    if(learn >= 8 && deliver >= 8) return {loop:"DCPA", cls:"dcpa", note:"Beidhändig: Delivery + Experiment. Nutze DCPA für Lernen, PDCA für stabile Teilaufgaben."};
    if(learn >= 8) return {loop:"DCPA", cls:"dcpa", note:"Hohe Unsicherheit/Ambiguität: zuerst kleine Experimente, dann planen."};
    if(deliver >= 8) return {loop:"PDCA", cls:"pdca", note:"Hohe Volatilität/Komplexität, aber strukturierbar: iterativ planen/umsetzen/prüfen."};
    return {loop:"PDCA", cls:"pdca", note:"Moderate Lage: klein planen, transparent arbeiten, regelmäßig nachschärfen."};
  }

  function buildRoadmap(){
    const host = $("#roadmapBox");
    host.innerHTML = "";

    state.worlds.forEach((w,i)=>{
      const label = (w.name && w.name.trim()) ? w.name.trim() : `W${i+1}`;
      const l = chooseLoopForWorld(w);

      const steps48 = (l.loop === "DCPA")
        ? [
            "Do: 1–2 safe-to-fail Experimente definieren (klein, reversibel, Messpunkt).",
            "Check: nach 24–48h Signale sammeln (Daten/Feedback, Abbruchkriterium).",
            "Plan: nächste Hypothese festlegen, Experiment anpassen."
          ]
        : [
            "Plan: Ziel + Scope + Board aufsetzen (Kanban, WIP-Limit).",
            "Do: klein starten (1–2 Lieferpakete), Verantwortlichkeiten klären.",
            "Check: nach 48h Status & Blocker, Anpassungen für den nächsten Zyklus."
          ];

      const steps2w = (l.loop === "DCPA")
        ? [
            "2–3 Experimente parallel (max. 2 Wochen), klare Metriken.",
            "Gewinner skalieren, Verlierer stoppen, Learnings dokumentieren.",
            "Entscheidungslog pflegen: was wurde warum entschieden?"
          ]
        : [
            "Rolling Planning (2 Wochen): Prioritäten fixieren, Rest flexibel.",
            "Risiko-/Pre-Mortem für kritische Pfade.",
            "Review: messbare Ergebnisse + nächste Iteration planen."
          ];

      const steps8w = [
        "Stabilisieren & standardisieren: was funktioniert, wird SOP/Checkliste.",
        "Gap schließen: die schwächste Prime-Dimension gezielt verbessern (Training/Prozess).",
        "Messsystem: KPIs + Trigger für Re-Planung definieren."
      ];

      const item = document.createElement("div");
      item.className = "roadmap-item";
      item.innerHTML = `
        <div class="roadmap-top">
          <div class="roadmap-title">${esc(label)}</div>
          <div class="roadmap-loop ${l.cls}">${l.loop}</div>
        </div>
        <div class="vuca-hint" style="margin-top:6px;">${esc(l.note)}</div>

        <div class="vuca-divider" style="margin:10px 0;"></div>

        <div class="vuca-h3" style="margin:0 0 6px;">48h</div>
        <ul>${steps48.map(s=>`<li>${esc(s)}</li>`).join("")}</ul>

        <div class="vuca-h3" style="margin:10px 0 6px;">2 Wochen</div>
        <ul>${steps2w.map(s=>`<li>${esc(s)}</li>`).join("")}</ul>

        <div class="vuca-h3" style="margin:10px 0 6px;">4–8 Wochen</div>
        <ul>${steps8w.map(s=>`<li>${esc(s)}</li>`).join("")}</ul>
      `;
      host.appendChild(item);
    });
  }

  function buildAutoRecommendations(){
    const avg = worldPressureAvg();
    const readiness = primeReadiness5();

    const pressureList = ["V","U","C","A"].map(k=>({k, v: avg[k]})).sort((a,b)=>b.v-a.v);
    const topP = pressureList[0];

    const gapList = ["V","U","C","A"].map(k=>{
      const r = (typeof readiness[k]==="number") ? readiness[k] : null;
      const g = (r===null) ? null : +(avg[k]-r).toFixed(1);
      return {k, g, r};
    }).filter(x=>x.g !== null).sort((a,b)=>b.g-a.g);

    const topG = gapList.length ? gapList[0] : null;

    let msg = "";
    if(!topG){
      msg = "Beantworte Prime-Fragen (Grün/Gelb/Rot), damit das Tool die Gap-Prioritäten setzen kann.";
    }else{
      const b = TOOLBOX[topG.k];
      msg = `
        <div class="vuca-text">
          <strong>Stärkster VUCA-Druck:</strong> ${topP.k} (${topP.v}/5).<br/>
          <strong>Größter Gap:</strong> ${topG.k} (Druck ${avg[topG.k]}/5 vs. Reifegrad ${topG.r}/5 → Gap ${topG.g > 0 ? "+"+topG.g : topG.g}).<br/><br/>
          <strong>Empfohlener Fokus:</strong> <em>${esc(b.title)}</em><br/>
          Starte mit diesen 3 Tools:
          <ul style="margin:8px 0 0 18px;">
            <li>${esc(b.tools[0])}</li>
            <li>${esc(b.tools[1])}</li>
            <li>${esc(b.tools[2])}</li>
          </ul>
        </div>
      `;
    }

    $("#autoRecText").innerHTML = msg;
  }

  function updateInsights(){
    const title = state.caseTitle ? esc(state.caseTitle) : "—";
    const team  = state.caseContextTeam ? esc(state.caseContextTeam) : "—";
    const goal  = state.caseGoal ? esc(state.caseGoal) : "—";

    const avg = worldPressureAvg();
    const readiness = primeReadiness5();

    const pSorted = ["V","U","C","A"].map(k=>({k, v: avg[k]})).sort((a,b)=>b.v-a.v);
    const top = pSorted[0];

    const gaps = ["V","U","C","A"].map(k=>{
      const r = (typeof readiness[k]==="number") ? readiness[k] : null;
      return {k, gap: (r===null ? null : +(avg[k]-r).toFixed(1)), r};
    });

    const answeredAny = gaps.some(x=>x.gap !== null);

    const gapSorted = gaps.filter(x=>x.gap !== null).sort((a,b)=>b.gap-a.gap);
    const worst = gapSorted[0] || null;

    const insight = $("#insightBox");
    if(!answeredAny){
      insight.innerHTML = `
        <strong>Fall:</strong> ${title}<br/>
        <span style="color:#64748b">Kontext/Team:</span> <strong>${team}</strong> · <span style="color:#64748b">Ziel:</span> <strong>${goal}</strong><br/><br/>
        <strong>Nächster Schritt:</strong> Prime-Fragen beantworten (Grün/Gelb/Rot), damit das Tool Gap + Roadmap sauber priorisiert.
      `;
      return;
    }

    const worstTxt = worst
      ? `${worst.k}: Gap ${worst.gap>0?"+":""}${worst.gap} (Druck ${avg[worst.k]}/5 vs. Reifegrad ${worst.r}/5)`
      : "—";

    insight.innerHTML = `
      <strong>Fall:</strong> ${title}<br/>
      <span style="color:#64748b">Kontext/Team:</span> <strong>${team}</strong> · <span style="color:#64748b">Ziel:</span> <strong>${goal}</strong><br/><br/>
      <strong>Erkenntnis aus den Fragen:</strong><br/>
      1) Höchster VUCA-Druck ist <strong>${top.k}</strong> (${top.v}/5).<br/>
      2) Größter Gap ist <strong>${esc(worstTxt)}</strong>.<br/>
      3) Empfehlung: Tools zuerst dort einsetzen, wo <strong>Gap</strong> am größten ist (Reifegrad aufbauen), danach stabilisieren/standardisieren.
    `;
  }

  // ----------------------------
  // Export helpers
  // ----------------------------
  async function exportNodePng(node, filename){
    try{
      const canvas = await html2canvas(node, { scale: 2, backgroundColor: "#ffffff" });
      const a = document.createElement("a");
      a.download = filename;
      a.href = canvas.toDataURL("image/png");
      a.click();
    }catch(e){
      toast("Export fehlgeschlagen. Prüfe Browserrechte.");
    }
  }

  // ----------------------------
  // JSON import/export
  // ----------------------------
  function downloadJson(){
    state.ts = new Date().toISOString();
    const blob = new Blob([JSON.stringify(state, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "vuca-entscheidungsfinder.json";
    a.click();
    URL.revokeObjectURL(url);
  }
  function loadJsonFile(file){
    file.text().then(txt=>{
      const parsed = JSON.parse(txt);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(parsed));
      if(!restore()){
        toast("JSON ungültig.");
        return;
      }
      syncCaseInputs();
      buildWorldList();
      buildPrimeGrid();
      scheduleUpdate();
      toast("JSON geladen.");
    }).catch(()=>{
      toast("JSON konnte nicht geladen werden.");
    });
  }

  // ----------------------------
  // Update loop
  // ----------------------------
  let rafPending = false;
  function scheduleUpdate(){
    if(rafPending) return;
    rafPending = true;
    requestAnimationFrame(()=>{
      rafPending = false;
      updateRadar();
      renderMatrix();
      updateGapBars();
      buildToolGrid();
      buildAutoRecommendations();
      buildRoadmap();
      updateInsights();
      persist();
    });
  }

  // ----------------------------
  // Events: Case inputs
  // ----------------------------
  ["caseTitle","caseContextTeam","caseDesc","caseGoal"].forEach(id=>{
    const el = $("#"+id);
    el.addEventListener("input", ()=>{
      state[id] = el.value;
      scheduleUpdate();
    });
  });

  $("#btnResetCase").addEventListener("click", ()=>{
    state.caseTitle="";
    state.caseContextTeam="";
    state.caseDesc="";
    state.caseGoal="";
    syncCaseInputs();
    scheduleUpdate();
    toast("Felder geleert.");
  });

  $("#btnBackup").addEventListener("click", ()=>{
    persist();
    toast("Backup gespeichert.");
  });
  $("#btnRestore").addEventListener("click", ()=>{
    const ok = restore();
    if(!ok){
      toast("Kein Backup gefunden.");
      return;
    }
    syncCaseInputs();
    buildWorldList();
    buildPrimeGrid();
    scheduleUpdate();
    toast("Backup geladen.");
  });

  $("#btnClearAll").addEventListener("click", ()=>{
    if(!confirm("Alles löschen (Fall, Welten, Prime)?")) return;
    localStorage.removeItem(STORAGE_KEY);
    state = {
      caseTitle:"",
      caseContextTeam:"",
      caseDesc:"",
      caseGoal:"",
      worlds:[ defaultWorld(1) ],
      prime:{ V:[null,null,null,null,null], U:[null,null,null,null,null], C:[null,null,null,null,null], A:[null,null,null,null,null] },
      ts: new Date().toISOString()
    };
    syncCaseInputs();
    buildWorldList();
    buildPrimeGrid();
    scheduleUpdate();
    toast("Alles gelöscht.");
  });

  $("#btnAddWorld").addEventListener("click", ()=>{
    if(state.worlds.length >= WORLD_MAX) return;
    state.worlds.push(defaultWorld(state.worlds.length+1));
    buildWorldList();
    scheduleUpdate();
    toast("Welt hinzugefügt.");
  });

  // Exports
  $("#exportAllPng").addEventListener("click", ()=> exportNodePng(ROOT, "vuca-dashboard.png"));
  $("#exportRadarPng").addEventListener("click", ()=> exportNodePng($("#radarWrap"), "vuca-radar.png"));
  $("#exportMatrixPng").addEventListener("click", ()=> exportNodePng($("#matrixWrap"), "vuca-matrix.png"));
  $("#exportGapPng").addEventListener("click", ()=> exportNodePng($("#gapWrap"), "vuca-gap.png"));
  $("#exportRadarPng2").addEventListener("click", ()=> exportNodePng($("#radarWrap"), "vuca-radar.png"));
  $("#exportMatrixPng2").addEventListener("click", ()=> exportNodePng($("#matrixWrap"), "vuca-matrix.png"));
  $("#exportGapPng2").addEventListener("click", ()=> exportNodePng($("#gapWrap"), "vuca-gap.png"));

  // JSON
  $("#btnExportJson").addEventListener("click", downloadJson);
  $("#btnImportJson").addEventListener("click", ()=> $("#jsonFile").click());
  $("#jsonFile").addEventListener("change", (ev)=>{
    const f = ev.target.files && ev.target.files[0];
    if(!f) return;
    loadJsonFile(f);
    ev.target.value = "";
  });

  // ----------------------------
  // Init
  // ----------------------------
  restore();

  syncCaseInputs();
  buildWorldList();
  buildPrimeGrid();
  buildToolGrid();
  ensureRadar();

  // Footer year (auto)
  const y = new Date().getFullYear();
  const yEl = $("#copyrightYear");
  if(yEl) yEl.textContent = String(y);

  scheduleUpdate();

})();
</script>
