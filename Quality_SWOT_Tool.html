<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SWOT Tool – Analyse & Maßnahmen</title>

  <!-- html2canvas (wird für PNG-Export benötigt) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root {
      --blue: #1155b2;
      --dark: #09387a;
      --light-bg: #f8fafc;
      --note: #fff9c4;

      /* SWOT Highlights */
      --s-bg: #ecfdf5;  /* Strengths */
      --w-bg: #fff1f2;  /* Weaknesses */
      --o-bg: #eff6ff;  /* Opportunities */
      --t-bg: #fff7ed;  /* Threats */
      --s-b: #22c55e;
      --w-b: #ef4444;
      --o-b: #3b82f6;
      --t-b: #f97316;
    }

    body { margin: 0; background: #ffffff; }

    .swot-app { max-width: 1100px; margin: 20px auto; font-family: 'Segoe UI', Roboto, sans-serif; color: #27304d; padding: 0 12px; }
    .swot-card { background: #fff; border: 1px solid #d1d9e6; border-radius: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; }

    /* Intro-Sektion */
    .tool-intro { padding: 22px 25px; border-bottom: 3px solid var(--blue); background: var(--light-bg); }
    .tool-intro-top { display:flex; align-items:flex-start; justify-content:space-between; gap: 15px; flex-wrap: wrap; }
    .tool-title { margin: 0; color: var(--dark); font-size: 20px; text-transform: uppercase; }
    .tool-sub { margin: 6px 0 0; font-size: 13px; color: #64748b; }

    .tool-grid { margin-top: 16px; display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .tool-box { background:#fff; border: 1px solid #d1d9e6; border-radius: 4px; padding: 12px 14px; }
    .tool-box h3 { margin: 0 0 6px 0; font-size: 13px; color: var(--dark); text-transform: uppercase; }
    .tool-box p, .tool-box ol { margin: 0; font-size: 13px; color:#334155; }
    .tool-box ol { padding-left: 18px; }
    .tool-privacy { border-left: 3px solid var(--blue); }

    .tool-box a { color: var(--blue); text-decoration: none; }
    .tool-box a:hover { text-decoration: underline; }

    /* Language switch */
    .lang-switch { display:flex; gap: 8px; align-items:center; }
    .lang-switch .i-btn { padding: 8px 12px; font-size: 12px; }

    .swot-body { padding: 25px; }
    .swot-drawing-area { padding: 22px; background: white; border: 1px solid #edf2f7; position: relative; }

    /* Kopfbereich im Capture */
    .swot-headerbar {
      display:flex; justify-content:space-between; align-items:flex-start; gap: 12px; flex-wrap: wrap;
      padding-bottom: 14px; margin-bottom: 14px; border-bottom: 1px solid #eef2f7;
    }
    .swot-context { flex: 1; min-width: 260px; }
    .swot-context label { display:block; font-size: 12px; color:#64748b; margin-bottom: 6px; text-transform: uppercase; font-weight: 700; }
    .swot-context textarea {
      width: 100%; min-height: 64px; resize: vertical; border: 1px solid #d1d9e6; border-radius: 4px;
      padding: 10px; font-family: inherit; font-size: 13px; outline: none;
    }
    .swot-badges { display:flex; gap: 8px; flex-wrap: wrap; align-items:center; }
    .badge {
      font-size: 11px; font-weight: 800; text-transform: uppercase;
      padding: 6px 8px; border-radius: 999px; border: 1px solid #d1d9e6; background: #fff; color:#334155;
    }
    .badge.s { border-color: var(--s-b); }
    .badge.w { border-color: var(--w-b); }
    .badge.o { border-color: var(--o-b); }
    .badge.t { border-color: var(--t-b); }

    /* Achsen Hinweis */
    .swot-axis {
      display:flex; justify-content:space-between; align-items:center; gap: 10px; flex-wrap: wrap;
      margin: 6px 0 10px 0; font-size: 12px; color:#64748b;
    }
    .swot-axis strong { color: var(--dark); }

    /* SWOT Matrix */
    .swot-matrix {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .swot-quadrant {
      border: 1px solid #d1d9e6;
      border-radius: 4px;
      padding: 12px 14px;
      min-height: 190px;
      display:flex;
      flex-direction: column;
    }
    .q-title {
      display:flex; justify-content:space-between; align-items:center; gap: 10px;
      margin: 0 0 10px 0;
      font-size: 13px; font-weight: 900; text-transform: uppercase;
      color: var(--dark);
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(0,0,0,0.06);
    }
    .q-title small { font-weight: 800; color:#64748b; text-transform: none; }
    .q-s { background: var(--s-bg); border-left: 4px solid var(--s-b); }
    .q-w { background: var(--w-bg); border-left: 4px solid var(--w-b); }
    .q-o { background: var(--o-bg); border-left: 4px solid var(--o-b); }
    .q-t { background: var(--t-bg); border-left: 4px solid var(--t-b); }

    .notes-container { display:flex; flex-direction: column; gap: 6px; flex-grow: 1; }
    .note-item {
      background: var(--note);
      padding: 6px;
      font-size: 12px;
      border-left: 3px solid #fbc02d;
      box-shadow: 2px 2px 4px rgba(0,0,0,0.05);
      position: relative;
      padding-right: 30px;
      border-radius: 3px;
    }
    .note-item textarea { width: 100%; border: none; background: transparent; resize: none; font-family: inherit; outline: none; }

    .note-delete {
      position: absolute;
      top: 4px; right: 6px;
      border: none; background: transparent; cursor: pointer;
      font-size: 18px; line-height: 1;
      color: #94a3b8;
    }
    .note-delete:hover { color: #e53e3e; }

    .btn-add {
      background: none; border: 1px dashed #cbd5e1; color: #94a3b8;
      cursor: pointer; font-size: 11px;
      margin-top: 10px; padding: 6px; border-radius: 4px;
      text-transform: uppercase; font-weight: 800;
    }
    .btn-add:hover { background: rgba(255,255,255,0.7); color: var(--blue); border-color: var(--blue); }

    /* Ableitung von Maßnahmen */
    .swot-highlight {
      margin-top: 16px;
      border-top: 2px solid var(--blue);
      padding-top: 14px;
    }
    .highlight-title {
      margin: 0 0 6px 0;
      font-size: 13px;
      color: var(--dark);
      text-transform: uppercase;
      font-weight: 900;
    }
    .highlight-sub {
      margin: 0 0 10px 0;
      font-size: 13px;
      color: #64748b;
    }

    /* Maßnahmen-Übersicht */
    .overview-box{
      background:#fff;
      border: 1px solid #d1d9e6;
      border-radius: 4px;
      padding: 12px 14px;
      margin-top: 12px;
    }
    .overview-head{
      display:flex; justify-content:space-between; align-items:flex-start; gap: 10px; flex-wrap: wrap;
      margin-bottom: 10px;
    }
    .overview-head h4{
      margin: 0;
      font-size: 13px;
      color: var(--dark);
      text-transform: uppercase;
      font-weight: 900;
    }
    .overview-sub{
      margin: 4px 0 0;
      font-size: 13px;
      color:#64748b;
    }
    .overview-table{
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .overview-table th, .overview-table td{
      border-top: 1px solid #e2e8f0;
      padding: 8px 6px;
      vertical-align: top;
      text-align: left;
    }
    .overview-table th{
      color:#334155;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .3px;
    }
    .tag{
      display:inline-block;
      font-size: 11px;
      font-weight: 900;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid #d1d9e6;
      background:#fff;
      color:#334155;
      white-space: nowrap;
    }
    .tag.SO{ border-color: var(--s-b); }
    .tag.ST{ border-color: var(--t-b); }
    .tag.WO{ border-color: var(--o-b); }
    .tag.WT{ border-color: var(--w-b); }
    .prio{
      font-weight: 900;
      color:#0f172a;
    }
    .overview-empty{
      border-top: 1px solid #e2e8f0;
      padding-top: 10px;
      color:#64748b;
      font-size: 13px;
    }

    .strategy-grid {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 10px;
    }
    .strategy-box {
      background:#fff;
      border: 1px solid #d1d9e6;
      border-radius: 4px;
      padding: 12px 14px;
    }
    .strategy-box h4 {
      margin: 0 0 6px 0;
      font-size: 13px;
      color: var(--dark);
      text-transform: uppercase;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
    }
    .strategy-pill {
      font-size: 11px;
      font-weight: 900;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #d1d9e6;
      background: #fff;
      color:#334155;
      white-space: nowrap;
    }
    .pill-so { border-color: var(--s-b); }
    .pill-st { border-color: var(--t-b); }
    .pill-wo { border-color: var(--o-b); }
    .pill-wt { border-color: var(--w-b); }

    .strategy-box p { margin: 0; font-size: 13px; color:#334155; }
    .strategy-list { margin: 10px 0 0; display:flex; flex-direction: column; gap: 6px; }

    .measure-item {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      padding: 8px 10px;
      position: relative;
      padding-right: 30px;
    }
    .measure-item textarea {
      width: 100%;
      border: none;
      resize: vertical;
      min-height: 42px;
      font-family: inherit;
      font-size: 13px;
      outline: none;
      background: transparent;
    }
    .measure-delete {
      position:absolute;
      top: 6px; right: 8px;
      border: none; background: transparent; cursor: pointer;
      font-size: 18px; line-height: 1;
      color: #94a3b8;
    }
    .measure-delete:hover { color: #e53e3e; }

    .measure-meta{
      display:grid;
      grid-template-columns: 1fr 140px 120px;
      gap: 8px;
      margin-top: 6px;
    }
    .measure-meta label{
      display:block;
      font-size: 11px;
      font-weight: 900;
      text-transform: uppercase;
      color:#64748b;
      margin-bottom: 4px;
    }
    .measure-meta input, .measure-meta select{
      width: 100%;
      border: 1px solid #d1d9e6;
      border-radius: 4px;
      padding: 8px 9px;
      font-family: inherit;
      font-size: 13px;
      outline: none;
      background:#fff;
    }
    @media(max-width: 560px){
      .measure-meta{ grid-template-columns: 1fr; }
    }

    .measure-actions { margin-top: 10px; display:flex; gap: 8px; flex-wrap: wrap; }
    .mini-btn {
      padding: 8px 10px;
      font-size: 11px;
      font-weight: 900;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #d1d9e6;
      background: #fff;
      text-transform: uppercase;
      color:#334155;
    }
    .mini-btn:hover { border-color: var(--blue); color: var(--blue); background: #f8fafc; }

    /* Actions */
    .swot-actions {
      margin-top: 18px;
      padding-top: 16px;
      border-top: 2px solid var(--blue);
      display:flex; gap: 10px; flex-wrap: wrap;
    }
    .i-btn {
      padding: 10px 18px;
      font-size: 13px;
      font-weight: bold;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #d1d9e6;
      background: #fff;
      text-transform: uppercase;
      text-decoration: none;
      display:inline-flex; align-items:center;
    }
    .i-btn.primary { background: var(--blue); color: #fff; border-color: var(--blue); }
    .i-btn.danger { color: #e53e3e; }

    /* Letzte Sektion */
    .tool-more { margin-top: 22px; padding-top: 18px; border-top: 2px solid var(--blue); }
    .more-title { margin: 0 0 6px 0; font-size: 13px; color: var(--dark); text-transform: uppercase; }
    .more-sub { margin: 0 0 10px 0; font-size: 13px; color: #64748b; }
    .more-list { margin: 8px 0 0; padding-left: 18px; font-size: 13px; color:#334155; }
    .more-list li { margin: 4px 0; }

    /* Footer */
    .swot-footer {
      padding: 12px 25px;
      background: var(--light-bg);
      border-top: 1px solid #d1d9e6;
      font-size: 12px;
      color: #64748b;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    @media (max-width: 900px) {
      .tool-grid { grid-template-columns: 1fr; }
      .swot-matrix { grid-template-columns: 1fr; }
      .strategy-grid { grid-template-columns: 1fr; }
      .tool-intro, .swot-body, .swot-footer { padding-left: 16px; padding-right: 16px; }
    }

    /* Print */
    @media print {
      .swot-actions,
      .lang-switch,
      .tool-more a {
        display: none !important;
      }
      .swot-card {
        box-shadow: none !important;
        border: none !important;
      }
      .swot-app { margin: 0 !important; padding: 0 !important; }
      .swot-body { padding: 0 !important; }
      .swot-drawing-area { border: none !important; }
    }
  </style>
</head>

<body>
  <div id="qm-swot-app" class="swot-app">
    <section class="swot-card">

      <!-- Sektion 1: Intro + Grid -->
      <section class="tool-intro">
        <div class="tool-intro-top">
          <div>
            <h2 class="tool-title" data-i18n="title">SWOT Tool – Analyse &amp; Maßnahmen</h2>
            <p class="tool-sub" data-i18n="subtitle">Stärken/Schwächen &amp; Chancen/Risiken strukturieren – und daraus konkrete Maßnahmen ableiten.</p>
          </div>

          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;">
            <div class="lang-switch" aria-label="Language switch">
              <button type="button" class="i-btn" id="btnLangDE">DE</button>
              <button type="button" class="i-btn" id="btnLangEN">EN</button>
            </div>
            <a class="i-btn" href="https://tools.quality.de/" data-i18n="backHome">Zurück zur Startseite</a>
          </div>
        </div>

        <div class="tool-grid">
          <div class="tool-box">
            <h3 data-i18n="boxToolNameTitle">Name Tool</h3>
            <p data-i18n="boxToolNameText">SWOT-Analyse – Matrix + Maßnahmen (SO / ST / WO / WT)</p>
          </div>

          <div class="tool-box">
            <h3 data-i18n="boxGoalTitle">Ziel</h3>
            <p data-i18n="boxGoalText">Eine kompakte Strategie-Übersicht erstellen: Faktoren sammeln, bewerten und anschließend in umsetzbare Maßnahmen überführen.</p>
          </div>

          <div class="tool-box">
            <h3 data-i18n="boxHowTitle">So benutzt du das Tool</h3>
            <ol>
              <li data-i18n="step1">Thema/Scope oben eintragen.</li>
              <li data-i18n="step2">SWOT-Faktoren pro Quadrant hinzufügen (X löscht Einträge).</li>
              <li data-i18n="step3"><b>Ableitung:</b> Aus der SWOT Maßnahmen ableiten (SO/ST/WO/WT) inkl. Termin & Priorität.</li>
              <li data-i18n="step4">Export als PNG oder als JSON speichern (und wieder laden).</li>
            </ol>
          </div>

          <div class="tool-box tool-privacy">
            <h3 data-i18n="boxPrivacyTitle">Datenschutz</h3>
            <p data-i18n="boxPrivacyText">Dieses Tool arbeitet vollständig im Browser. Es werden keine Daten auf einem Server gespeichert. Zugriff hat nur die Person, die die Datei lokal speichert bzw. lädt.</p>
          </div>
        </div>
      </section>

      <div class="swot-body">
        <div id="capture-area" class="swot-drawing-area">

          <!-- Kopf / Kontext -->
          <div class="swot-headerbar">
            <div class="swot-context">
              <label for="contextInput" data-i18n="contextLabel">Thema / Ziel / Scope</label>
              <textarea id="contextInput" data-i18n-placeholder="contextPlaceholder" placeholder="z.B. Produktlinie X – Markteintritt DACH 2026, Ziel: Umsatz +15% ..."></textarea>
            </div>
            <div class="swot-badges" aria-label="Legende">
              <span class="badge s" data-i18n="badgeS">Stärken (Intern)</span>
              <span class="badge w" data-i18n="badgeW">Schwächen (Intern)</span>
              <span class="badge o" data-i18n="badgeO">Chancen (Extern)</span>
              <span class="badge t" data-i18n="badgeT">Risiken (Extern)</span>
            </div>
          </div>

          <!-- Achsen Hinweis -->
          <div class="swot-axis">
            <div><strong data-i18n="axisInternStrong">Intern</strong><span data-i18n="axisInternText">: Stärken / Schwächen</span></div>
            <div><strong data-i18n="axisExternStrong">Extern</strong><span data-i18n="axisExternText">: Chancen / Risiken</span></div>
          </div>

          <!-- SWOT Matrix -->
          <div class="swot-matrix">
            <div class="swot-quadrant q-s" data-q="S">
              <div class="q-title"><span data-i18n="qS">Stärken</span> <small>(Strengths)</small></div>
              <div class="notes-container" id="notes-S"></div>
              <button class="btn-add" type="button" onclick="addNote('S')" data-i18n="addFactor">+ Faktor</button>
            </div>

            <div class="swot-quadrant q-w" data-q="W">
              <div class="q-title"><span data-i18n="qW">Schwächen</span> <small>(Weaknesses)</small></div>
              <div class="notes-container" id="notes-W"></div>
              <button class="btn-add" type="button" onclick="addNote('W')" data-i18n="addFactor">+ Faktor</button>
            </div>

            <div class="swot-quadrant q-o" data-q="O">
              <div class="q-title"><span data-i18n="qO">Chancen</span> <small>(Opportunities)</small></div>
              <div class="notes-container" id="notes-O"></div>
              <button class="btn-add" type="button" onclick="addNote('O')" data-i18n="addFactor">+ Faktor</button>
            </div>

            <div class="swot-quadrant q-t" data-q="T">
              <div class="q-title"><span data-i18n="qT">Risiken</span> <small>(Threats)</small></div>
              <div class="notes-container" id="notes-T"></div>
              <button class="btn-add" type="button" onclick="addNote('T')" data-i18n="addFactor">+ Faktor</button>
            </div>
          </div>

          <!-- Ableitung von Maßnahmen -->
          <section class="swot-highlight" aria-label="Maßnahmen aus SWOT">
            <h3 class="highlight-title" data-i18n="deriveTitle">Ableitung von Maßnahmen</h3>
            <p class="highlight-sub" data-i18n="deriveSub">
              Vorgehen: <b>(1)</b> Faktoren clustern &amp; bewerten → <b>(2)</b> Strategietyp wählen (SO/ST/WO/WT) → <b>(3)</b> Maßnahmen formulieren → <b>(4)</b> priorisieren &amp; terminieren.
            </p>

            <!-- Maßnahmen-Übersicht -->
            <div class="overview-box" aria-label="Maßnahmenübersicht">
              <div class="overview-head">
                <div>
                  <h4 data-i18n="overviewTitle">Maßnahmenübersicht</h4>
                  <div class="overview-sub" data-i18n="overviewSub">Alle Maßnahmen (SO/ST/WO/WT) in einer Liste – inkl. Termin & Priorität.</div>
                </div>
              </div>

              <div id="overviewHost">
                <div class="overview-empty" data-i18n="overviewEmpty">Noch keine Maßnahmen. Füge unten Maßnahmen hinzu.</div>
              </div>
            </div>

            <div class="strategy-grid">
              <div class="strategy-box">
                <h4><span data-i18n="soTitle">SO-Strategien</span> <span class="strategy-pill pill-so" data-i18n="pillSO">Stärken × Chancen</span></h4>
                <p data-i18n="soDesc">Offensiv nutzen: Stärken einsetzen, um Chancen maximal auszuschöpfen.</p>
                <div class="strategy-list" id="measures-SO"></div>
                <div class="measure-actions">
                  <button class="mini-btn" type="button" onclick="addMeasure('SO')" data-i18n="addMeasure">+ Maßnahme</button>
                </div>
              </div>

              <div class="strategy-box">
                <h4><span data-i18n="stTitle">ST-Strategien</span> <span class="strategy-pill pill-st" data-i18n="pillST">Stärken × Risiken</span></h4>
                <p data-i18n="stDesc">Absichern: Stärken nutzen, um Risiken zu reduzieren oder zu umgehen.</p>
                <div class="strategy-list" id="measures-ST"></div>
                <div class="measure-actions">
                  <button class="mini-btn" type="button" onclick="addMeasure('ST')" data-i18n="addMeasure">+ Maßnahme</button>
                </div>
              </div>

              <div class="strategy-box">
                <h4><span data-i18n="woTitle">WO-Strategien</span> <span class="strategy-pill pill-wo" data-i18n="pillWO">Schwächen × Chancen</span></h4>
                <p data-i18n="woDesc">Aufholen: Schwächen abbauen, um Chancen realistisch nutzen zu können.</p>
                <div class="strategy-list" id="measures-WO"></div>
                <div class="measure-actions">
                  <button class="mini-btn" type="button" onclick="addMeasure('WO')" data-i18n="addMeasure">+ Maßnahme</button>
                </div>
              </div>

              <div class="strategy-box">
                <h4><span data-i18n="wtTitle">WT-Strategien</span> <span class="strategy-pill pill-wt" data-i18n="pillWT">Schwächen × Risiken</span></h4>
                <p data-i18n="wtDesc">Schützen: Schwächen minimieren und Risiken vermeiden (Defensivstrategie).</p>
                <div class="strategy-list" id="measures-WT"></div>
                <div class="measure-actions">
                  <button class="mini-btn" type="button" onclick="addMeasure('WT')" data-i18n="addMeasure">+ Maßnahme</button>
                </div>
              </div>
            </div>
          </section>

        </div>

        <!-- Actions -->
        <div class="swot-actions">
          <a class="i-btn" href="https://tools.quality.de/" data-i18n="backHome">Zurück zur Startseite</a>
          <button type="button" class="i-btn primary" id="btnExport" data-i18n="btnExport">Bild exportieren (PNG)</button>
          <button type="button" class="i-btn" id="btnPrint" data-i18n="btnPrint">Drucken</button>
          <button type="button" class="i-btn" id="btnSave" data-i18n="btnSave">JSON Speichern</button>
          <label class="i-btn" style="cursor:pointer">
            <span data-i18n="btnUpload">Upload</span>
            <input type="file" id="btnLoad" hidden>
          </label>
          <button type="button" class="i-btn danger" id="btnReset" data-i18n="btnReset">Reset</button>
        </div>

        <!-- Letzte Sektion (Links) -->
        <section class="tool-more">
          <h3 class="more-title" data-i18n="moreTitle">Weiterführende Infos</h3>
          <p class="more-sub" data-i18n="moreSub">Lexikonartikel &amp; passende Weiterbildungen (öffnet in neuem Tab).</p>

          <div class="tool-grid">
            <div class="tool-box">
              <h3 data-i18n="lexTitle">Lexikon</h3>
              <p data-i18n="lexText">Definition, Einsatzbereiche &amp; Tipps zur SWOT-Analyse.</p>
              <p style="margin-top:8px;">
                <a href="https://www.quality.de/lexikon/swot-analyse/" target="_blank" rel="noopener" data-i18n="lexLink">
                  Zum Lexikonartikel: SWOT-Analyse
                </a>
              </p>
            </div>

            <div class="tool-box">
              <h3 data-i18n="trainTitle">Ausbildungen &amp; Seminare</h3>
              <p data-i18n="trainText">Vertiefe deine Methodenkompetenz im Qualitätsmanagement:</p>
              <ul class="more-list">
                <li>
                  <a href="https://www.quality.de/weiterbildung/8d-seminare-8d-schulungen/" target="_blank" rel="noopener" data-i18n="train8d">
                    8D Schulungen
                  </a>
                </li>
                <li>
                  <a href="https://www.quality.de/weiterbildung/kvp/" target="_blank" rel="noopener" data-i18n="trainKvp">
                    KVP Schulungen
                  </a>
                </li>
                <li>
                  <a href="https://www.quality.de/weiterbildung/qualitaetsmanagement/" target="_blank" rel="noopener" data-i18n="trainQm">
                    Qualitätsmanagement
                  </a>
                </li>
                <li>
                  <a href="https://www.quality.de/weiterbildung/opex-seminare-ausbildungen/" target="_blank" rel="noopener" data-i18n="trainOpex">
                    OPEX Seminare &amp; Ausbildungen
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </section>

      </div>

      <!-- Footer -->
      <footer class="swot-footer">
        <div>© <span id="copyrightYear"></span></div>
        <div><span data-i18n="poweredBy">Powered by</span> Quality Services &amp; Wissen GmbH</div>
      </footer>

    </section>
  </div>

  <script>
    /* ========= i18n (DE/EN) ========= */
    const I18N = {
      de: {
        title: "SWOT Tool – Analyse & Maßnahmen",
        subtitle: "Stärken/Schwächen & Chancen/Risiken strukturieren – und daraus konkrete Maßnahmen ableiten.",
        backHome: "Zurück zur Startseite",

        boxToolNameTitle: "Name Tool",
        boxToolNameText: "SWOT-Analyse – Matrix + Maßnahmen (SO / ST / WO / WT)",
        boxGoalTitle: "Ziel",
        boxGoalText: "Eine kompakte Strategie-Übersicht erstellen: Faktoren sammeln, bewerten und anschließend in umsetzbare Maßnahmen überführen.",
        boxHowTitle: "So benutzt du das Tool",
        step1: "Thema/Scope oben eintragen.",
        step2: "SWOT-Faktoren pro Quadrant hinzufügen (X löscht Einträge).",
        step3: "Ableitung: Aus der SWOT Maßnahmen ableiten (SO/ST/WO/WT) inkl. Termin & Priorität.",
        step4: "Export als PNG oder als JSON speichern (und wieder laden).",
        boxPrivacyTitle: "Datenschutz",
        boxPrivacyText: "Dieses Tool arbeitet vollständig im Browser. Es werden keine Daten auf einem Server gespeichert. Zugriff hat nur die Person, die die Datei lokal speichert bzw. lädt.",

        contextLabel: "Thema / Ziel / Scope",
        contextPlaceholder: "z.B. Produktlinie X – Markteintritt DACH 2026, Ziel: Umsatz +15% ...",

        badgeS: "Stärken (Intern)",
        badgeW: "Schwächen (Intern)",
        badgeO: "Chancen (Extern)",
        badgeT: "Risiken (Extern)",

        axisInternStrong: "Intern",
        axisInternText: ": Stärken / Schwächen",
        axisExternStrong: "Extern",
        axisExternText: ": Chancen / Risiken",

        qS: "Stärken",
        qW: "Schwächen",
        qO: "Chancen",
        qT: "Risiken",

        addFactor: "+ Faktor",
        factorPlaceholder: "Faktor eingeben...",
        deleteEntry: "Eintrag löschen",

        deriveTitle: "Ableitung von Maßnahmen",
        deriveSub: "Vorgehen: (1) Faktoren clustern & bewerten → (2) Strategietyp wählen (SO/ST/WO/WT) → (3) Maßnahmen formulieren → (4) priorisieren & terminieren.",

        overviewTitle: "Maßnahmenübersicht",
        overviewSub: "Alle Maßnahmen (SO/ST/WO/WT) in einer Liste – inkl. Termin & Priorität.",
        overviewEmpty: "Noch keine Maßnahmen. Füge unten Maßnahmen hinzu.",
        colType: "Typ",
        colMeasure: "Maßnahme",
        colDue: "Termin",
        colPrio: "Priorität",

        soTitle: "SO-Strategien",
        stTitle: "ST-Strategien",
        woTitle: "WO-Strategien",
        wtTitle: "WT-Strategien",
        pillSO: "Stärken × Chancen",
        pillST: "Stärken × Risiken",
        pillWO: "Schwächen × Chancen",
        pillWT: "Schwächen × Risiken",

        soDesc: "Offensiv nutzen: Stärken einsetzen, um Chancen maximal auszuschöpfen.",
        stDesc: "Absichern: Stärken nutzen, um Risiken zu reduzieren oder zu umgehen.",
        woDesc: "Aufholen: Schwächen abbauen, um Chancen realistisch nutzen zu können.",
        wtDesc: "Schützen: Schwächen minimieren und Risiken vermeiden (Defensivstrategie).",

        addMeasure: "+ Maßnahme",
        deleteMeasure: "Maßnahme löschen",
        measurePlaceholder: "Maßnahme formulieren (Was? Wer? Bis wann? Wirkung?) ...",
        dueLabel: "Termin",
        prioLabel: "Priorität",
        ownerLabel: "Owner",
        ownerPlaceholder: "z.B. Max / Einkauf",
        prioP1: "P1 (hoch)",
        prioP2: "P2 (mittel)",
        prioP3: "P3 (niedrig)",

        btnExport: "Bild exportieren (PNG)",
        btnPrint: "Drucken",
        btnSave: "JSON Speichern",
        btnUpload: "Upload",
        btnReset: "Reset",
        confirmReset: "Alles löschen?",

        moreTitle: "Weiterführende Infos",
        moreSub: "Lexikonartikel & passende Weiterbildungen (öffnet in neuem Tab).",
        lexTitle: "Lexikon",
        lexText: "Definition, Einsatzbereiche & Tipps zur SWOT-Analyse.",
        lexLink: "Zum Lexikonartikel: SWOT-Analyse",
        trainTitle: "Ausbildungen & Seminare",
        trainText: "Vertiefe deine Methodenkompetenz im Qualitätsmanagement:",
        train8d: "8D Schulungen",
        trainKvp: "KVP Schulungen",
        trainQm: "Qualitätsmanagement",
        trainOpex: "OPEX Seminare & Ausbildungen",

        poweredBy: "Powered by",

        pngName: "Quality_SWOT.png",
        jsonName: "SWOT_Export.json",
        loadError: "Fehler beim Laden der Datei."
      },

      en: {
        title: "SWOT Tool – Analysis & Actions",
        subtitle: "Structure strengths/weaknesses and opportunities/threats – then derive concrete actions.",
        backHome: "Back to home",

        boxToolNameTitle: "Tool name",
        boxToolNameText: "SWOT Analysis – Matrix + Actions (SO / ST / WO / WT)",
        boxGoalTitle: "Goal",
        boxGoalText: "Create a compact strategy overview: collect factors, review them, then turn them into actionable measures.",
        boxHowTitle: "How to use this tool",
        step1: "Enter topic/scope at the top.",
        step2: "Add SWOT factors per quadrant (X deletes entries).",
        step3: "Derivation: derive actions (SO/ST/WO/WT) incl. due date & priority.",
        step4: "Export as PNG or save as JSON (and reload it).",
        boxPrivacyTitle: "Privacy",
        boxPrivacyText: "This tool runs entirely in your browser. No data is stored on any server. Only the person who saves/loads files locally has access.",

        contextLabel: "Topic / Goal / Scope",
        contextPlaceholder: "e.g. Product line X – DACH market entry 2026, goal: revenue +15% ...",

        badgeS: "Strengths (Internal)",
        badgeW: "Weaknesses (Internal)",
        badgeO: "Opportunities (External)",
        badgeT: "Threats (External)",

        axisInternStrong: "Internal",
        axisInternText: ": strengths / weaknesses",
        axisExternStrong: "External",
        axisExternText: ": opportunities / threats",

        qS: "Strengths",
        qW: "Weaknesses",
        qO: "Opportunities",
        qT: "Threats",

        addFactor: "+ Factor",
        factorPlaceholder: "Enter factor...",
        deleteEntry: "Delete entry",

        deriveTitle: "Deriving Actions",
        deriveSub: "Approach: (1) cluster & review factors → (2) pick strategy type (SO/ST/WO/WT) → (3) formulate actions → (4) prioritize & schedule.",

        overviewTitle: "Action Overview",
        overviewSub: "All actions (SO/ST/WO/WT) in one list – incl. due date & priority.",
        overviewEmpty: "No actions yet. Add actions below.",
        colType: "Type",
        colMeasure: "Action",
        colDue: "Due date",
        colPrio: "Priority",

        soTitle: "SO strategies",
        stTitle: "ST strategies",
        woTitle: "WO strategies",
        wtTitle: "WT strategies",
        pillSO: "Strengths × Opportunities",
        pillST: "Strengths × Threats",
        pillWO: "Weaknesses × Opportunities",
        pillWT: "Weaknesses × Threats",

        soDesc: "Go offensive: use strengths to maximize opportunities.",
        stDesc: "Secure: use strengths to reduce or avoid threats.",
        woDesc: "Catch up: reduce weaknesses to realistically seize opportunities.",
        wtDesc: "Protect: minimize weaknesses and avoid threats (defensive).",

        addMeasure: "+ Action",
        deleteMeasure: "Delete action",
        measurePlaceholder: "Formulate action (What? Who? By when? Impact?) ...",
        dueLabel: "Due date",
        prioLabel: "Priority",
        ownerLabel: "Owner",
        ownerPlaceholder: "e.g. Alex / Procurement",
        prioP1: "P1 (high)",
        prioP2: "P2 (medium)",
        prioP3: "P3 (low)",

        btnExport: "Export image (PNG)",
        btnPrint: "Print",
        btnSave: "Save JSON",
        btnUpload: "Upload",
        btnReset: "Reset",
        confirmReset: "Delete everything?",

        moreTitle: "More information",
        moreSub: "Glossary article & relevant training (opens in a new tab).",
        lexTitle: "Glossary",
        lexText: "Definition, use cases & tips for SWOT analysis.",
        lexLink: "Open glossary article: SWOT Analysis",
        trainTitle: "Training & courses",
        trainText: "Deepen your method skills in quality management:",
        train8d: "8D training",
        trainKvp: "Continuous improvement (CIP) training",
        trainQm: "Quality management",
        trainOpex: "OPEX courses & programs",

        poweredBy: "Powered by",

        pngName: "Quality_SWOT.png",
        jsonName: "SWOT_Export.json",
        loadError: "Error loading the file."
      }
    };

    const STORAGE_KEY = "qm_swot_state_v1";
    let currentLang = (localStorage.getItem("qmLang")
      || (navigator.language && navigator.language.toLowerCase().startsWith("de") ? "de" : "en"));

    function t(key) {
      return (I18N[currentLang] && I18N[currentLang][key]) ? I18N[currentLang][key] : key;
    }

    function applyI18n() {
      document.documentElement.lang = currentLang;

      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.dataset.i18n;
        el.textContent = t(key);
      });

      document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
        const key = el.dataset.i18nPlaceholder;
        el.placeholder = t(key);
      });

      const deBtn = document.getElementById("btnLangDE");
      const enBtn = document.getElementById("btnLangEN");
      if (deBtn && enBtn) {
        deBtn.classList.toggle("primary", currentLang === "de");
        enBtn.classList.toggle("primary", currentLang === "en");
      }
    }

    function setLanguage(lang) {
      currentLang = (lang === "de" || lang === "en") ? lang : "de";
      localStorage.setItem("qmLang", currentLang);
      applyI18n();
      rebuildOverview();
      // refresh placeholders in dynamic nodes
      document.querySelectorAll(".note-item textarea").forEach(ta => ta.placeholder = t("factorPlaceholder"));
      document.querySelectorAll(".measure-item textarea").forEach(ta => ta.placeholder = t("measurePlaceholder"));
      document.querySelectorAll(".note-delete").forEach(btn => { btn.title = t("deleteEntry"); btn.setAttribute("aria-label", t("deleteEntry")); });
      document.querySelectorAll(".measure-delete").forEach(btn => { btn.title = t("deleteMeasure"); btn.setAttribute("aria-label", t("deleteMeasure")); });
      document.querySelectorAll(".owner-input").forEach(i => i.placeholder = t("ownerPlaceholder"));
    }

    function persist(){
      const data = collectState();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }
    function restore(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return false;
      try{
        const data = JSON.parse(raw);
        if(!data || typeof data !== "object") return false;

        if (data.lang === "de" || data.lang === "en") currentLang = data.lang;
        applyI18n();

        document.getElementById("contextInput").value = data.context || "";

        // SWOT
        ["S","W","O","T"].forEach(k=>{
          const c = document.getElementById(`notes-${k}`);
          c.innerHTML = "";
          ((data.swot && data.swot[k]) || []).forEach(txt => addNote(k, txt));
        });

        // Measures
        ["SO","ST","WO","WT"].forEach(k=>{
          const c = document.getElementById(`measures-${k}`);
          c.innerHTML = "";
          ((data.measures && data.measures[k]) || []).forEach(m => addMeasure(k, m));
        });

        rebuildOverview();
        return true;
      }catch(e){
        return false;
      }
    }

    /* SWOT Faktor hinzufügen */
    function addNote(q, val = '') {
      const container = document.getElementById(`notes-${q}`);
      const div = document.createElement('div');
      div.className = 'note-item';

      const del = document.createElement('button');
      del.type = 'button';
      del.className = 'note-delete';
      del.title = t('deleteEntry');
      del.setAttribute('aria-label', t('deleteEntry'));
      del.innerHTML = '&times;';
      del.onclick = () => { div.remove(); persist(); };

      const ta = document.createElement('textarea');
      ta.rows = 2;
      ta.placeholder = t('factorPlaceholder');
      ta.value = val;
      ta.addEventListener("input", ()=> persist());

      div.appendChild(del);
      div.appendChild(ta);
      container.appendChild(div);

      persist();
    }

    function prioOptionsHtml(selected){
      const v = selected || "P2";
      return `
        <option value="P1" ${v==="P1"?"selected":""}>${t("prioP1")}</option>
        <option value="P2" ${v==="P2"?"selected":""}>${t("prioP2")}</option>
        <option value="P3" ${v==="P3"?"selected":""}>${t("prioP3")}</option>
      `;
    }

    /* Maßnahme hinzufügen (inkl. Termin, Priorität, Owner) */
    function addMeasure(type, val = '') {
      const container = document.getElementById(`measures-${type}`);
      const div = document.createElement('div');
      div.className = 'measure-item';
      div.dataset.type = type;

      // normalize object
      const obj = (val && typeof val === "object")
        ? { text: String(val.text||""), due: String(val.due||""), prio: String(val.prio||"P2"), owner: String(val.owner||"") }
        : { text: String(val||""), due: "", prio: "P2", owner: "" };

      const del = document.createElement('button');
      del.type = 'button';
      del.className = 'measure-delete';
      del.title = t('deleteMeasure');
      del.setAttribute('aria-label', t('deleteMeasure'));
      del.innerHTML = '&times;';
      del.onclick = () => { div.remove(); rebuildOverview(); persist(); };

      const ta = document.createElement('textarea');
      ta.placeholder = t('measurePlaceholder');
      ta.value = obj.text;
      ta.addEventListener("input", ()=> { rebuildOverview(); persist(); });

      const meta = document.createElement("div");
      meta.className = "measure-meta";
      meta.innerHTML = `
        <div>
          <label>${t("ownerLabel")}</label>
          <input type="text" class="owner-input" placeholder="${t("ownerPlaceholder")}" value="${escapeHtmlAttr(obj.owner)}" />
        </div>
        <div>
          <label>${t("dueLabel")}</label>
          <input type="date" class="due-input" value="${escapeHtmlAttr(obj.due)}" />
        </div>
        <div>
          <label>${t("prioLabel")}</label>
          <select class="prio-select">${prioOptionsHtml(obj.prio)}</select>
        </div>
      `;

      div.appendChild(del);
      div.appendChild(ta);
      div.appendChild(meta);
      container.appendChild(div);

      const ownerEl = div.querySelector(".owner-input");
      const dueEl = div.querySelector(".due-input");
      const prioEl = div.querySelector(".prio-select");

      ownerEl.addEventListener("input", ()=> { rebuildOverview(); persist(); });
      dueEl.addEventListener("input", ()=> { rebuildOverview(); persist(); });
      prioEl.addEventListener("change", ()=> { rebuildOverview(); persist(); });

      rebuildOverview();
      persist();
    }

    function escapeHtmlAttr(s){
      return String(s ?? "")
        .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;").replace(/'/g,"&#039;");
    }

    function collectState(){
      const data = {
        lang: currentLang,
        context: document.getElementById('contextInput').value,
        swot: { S:[], W:[], O:[], T:[] },
        measures: { SO:[], ST:[], WO:[], WT:[] }
      };

      ["S","W","O","T"].forEach(k=>{
        data.swot[k] = Array.from(document.querySelectorAll(`#notes-${k} textarea`)).map(t => t.value);
      });

      ["SO","ST","WO","WT"].forEach(k=>{
        const items = Array.from(document.querySelectorAll(`#measures-${k} .measure-item`));
        data.measures[k] = items.map(it => ({
          text: (it.querySelector("textarea")?.value || ""),
          owner: (it.querySelector(".owner-input")?.value || ""),
          due: (it.querySelector(".due-input")?.value || ""),
          prio: (it.querySelector(".prio-select")?.value || "P2")
        }));
      });

      return data;
    }

    function rebuildOverview(){
      const host = document.getElementById("overviewHost");
      const all = [];

      ["SO","ST","WO","WT"].forEach(type=>{
        const items = Array.from(document.querySelectorAll(`#measures-${type} .measure-item`));
        items.forEach(it=>{
          const text = (it.querySelector("textarea")?.value || "").trim();
          const owner = (it.querySelector(".owner-input")?.value || "").trim();
          const due = (it.querySelector(".due-input")?.value || "").trim();
          const prio = (it.querySelector(".prio-select")?.value || "P2").trim();
          if(text || owner || due){
            all.push({ type, text, owner, due, prio });
          }
        });
      });

      if(!all.length){
        host.innerHTML = `<div class="overview-empty">${t("overviewEmpty")}</div>`;
        return;
      }

      const prioRank = (p)=> (p==="P1"?1 : p==="P2"?2 : 3);
      all.sort((a,b)=>{
        const r = prioRank(a.prio) - prioRank(b.prio);
        if(r!==0) return r;
        return String(a.due||"9999-12-31").localeCompare(String(b.due||"9999-12-31"));
      });

      const rows = all.map(x=>{
        const ownerTxt = x.owner ? ` · ${escapeHtmlAttr(x.owner)}` : "";
        const dueTxt = x.due ? escapeHtmlAttr(x.due) : "—";
        const prioTxt = x.prio ? escapeHtmlAttr(x.prio) : "P2";
        return `
          <tr>
            <td><span class="tag ${x.type}">${x.type}</span></td>
            <td>${escapeHtmlAttr(x.text)}${ownerTxt}</td>
            <td>${dueTxt}</td>
            <td class="prio">${prioTxt}</td>
          </tr>
        `;
      }).join("");

      host.innerHTML = `
        <table class="overview-table">
          <thead>
            <tr>
              <th>${t("colType")}</th>
              <th>${t("colMeasure")}</th>
              <th>${t("colDue")}</th>
              <th>${t("colPrio")}</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }

    /* Export als Bild */
    document.getElementById('btnExport').onclick = () => {
      const area = document.getElementById('capture-area');
      html2canvas(area, { scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = t('pngName');
        link.href = canvas.toDataURL();
        link.click();
      });
    };

    /* Print */
    document.getElementById('btnPrint').onclick = () => window.print();

    /* Speichern als JSON */
    document.getElementById('btnSave').onclick = () => {
      const data = collectState();
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = t('jsonName');
      a.click();
    };

    /* Laden von JSON */
    document.getElementById('btnLoad').onchange = (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);

          if (data.lang === "de" || data.lang === "en") currentLang = data.lang;
          setLanguage(currentLang);

          document.getElementById('contextInput').value = data.context || '';

          // SWOT
          ['S','W','O','T'].forEach(k => {
            const c = document.getElementById(`notes-${k}`);
            c.innerHTML = '';
            ((data.swot && data.swot[k]) || []).forEach(txt => addNote(k, txt));
          });

          // Maßnahmen
          ['SO','ST','WO','WT'].forEach(k => {
            const c = document.getElementById(`measures-${k}`);
            c.innerHTML = '';
            ((data.measures && data.measures[k]) || []).forEach(m => addMeasure(k, m));
          });

          applyI18n();
          rebuildOverview();
          persist();
        } catch (err) {
          alert(t('loadError'));
        }
      };
      reader.readAsText(file);

      e.target.value = '';
    };

    /* Reset */
    document.getElementById('btnReset').onclick = () => {
      if (!confirm(t('confirmReset'))) return;
      localStorage.removeItem(STORAGE_KEY);
      location.reload();
    };

    /* Language buttons */
    document.getElementById("btnLangDE").onclick = () => setLanguage("de");
    document.getElementById("btnLangEN").onclick = () => setLanguage("en");

    /* Context autosave */
    const contextEl = document.getElementById("contextInput");
    contextEl.addEventListener("input", ()=>{
      persist();
      rebuildOverview();
    });

    /* Copyright */
    (function setCopyrightYear(){
      const el = document.getElementById('copyrightYear');
      if (el) el.textContent = new Date().getFullYear();
    })();

    /* init */
    // try restore
    const ok = restore();
    if(!ok){
      setLanguage(currentLang);
      rebuildOverview();
      persist();
    }else{
      // ensure language buttons reflect restored lang
      setLanguage(currentLang);
      rebuildOverview();
    }
  </script>
</body>
</html>
